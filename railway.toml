[build]
builder = "nixpacks" 
# Force redeploy: companion system fixes applied

[deploy]
startCommand = "cd backend && gunicorn --bind 0.0.0.0:$PORT --workers 2 --timeout 120 --keep-alive 2 --max-requests 1000 --max-requests-jitter 100 app_fixed:app"
healthcheckPath = "/health"
healthcheckTimeout = 120
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

# Persistent volume for database storage
[volumes]
data = "/data"

[build.env]
NIXPACKS_PYTHON_VERSION = "3.11"
NIXPACKS_INSTALL_CMD = "pip install -r backend/requirements.txt"