FROM ollama/ollama:latest

ENV OLLAMA_HOST=0.0.0.0:11434
ENV OLLAMA_KEEP_ALIVE=5m
ENV OLLAMA_NUM_PARALLEL=4

EXPOSE 11434

RUN echo '#!/bin/bash\nset -e\nollama serve &\nsleep 10\nif ! ollama list | grep -q "gemma2:2b"; then\n    ollama pull gemma2:2b\nfi\nwait' > /usr/local/bin/start-ollama.sh && chmod +x /usr/local/bin/start-ollama.sh

CMD ["/usr/local/bin/start-ollama.sh"]