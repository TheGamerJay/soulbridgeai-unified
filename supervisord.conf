[supervisord]
nodaemon=true
logfile=/tmp/supervisord.log
logfile_maxbytes=50MB
logfile_backups=10
loglevel=info
user=root

[program:ollama]
command=/bin/bash -lc "ollama serve"
priority=10
autostart=true
autorestart=true
stdout_logfile=/tmp/ollama.log
stderr_logfile=/tmp/ollama.log

[program:preload]
command=/bin/bash -lc "sleep 20; (ollama pull ${FREE_MODEL:-tinyllama} || true); (ollama rm phi3:mini 2>/dev/null || true); (ollama run ${FREE_MODEL:-tinyllama} 'test' 2>/dev/null || true); echo ${FREE_MODEL:-tinyllama} preload and warmup done"
priority=20
autostart=true
autorestart=false
stdout_logfile=/tmp/preload.log
stderr_logfile=/tmp/preload.log

[program:web]
command=/bin/bash -lc "cd /app && ./start.sh"
priority=30
autostart=true
autorestart=true
stdout_logfile=/tmp/web.log
stderr_logfile=/tmp/web.log