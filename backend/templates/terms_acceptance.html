<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accept Terms to Continue - SoulBridge AI</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <meta name="theme-color" content="#00ffff">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}?v={{ range(1000000) | random }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* Terms Acceptance Page Styling */
        html, body {
            background: #000000 !important;
            color: #e2e8f0 !important;
            font-family: system-ui, -apple-system, sans-serif !important;
            margin: 0 !important;
            padding: 0 !important;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Stunning cyan animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 15% 25%, rgba(0, 255, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(0, 255, 255, 0.08) 0%, transparent 45%),
                radial-gradient(circle at 45% 85%, rgba(0, 255, 255, 0.06) 0%, transparent 35%);
            pointer-events: none;
            z-index: -1;
            animation: breathe 4s ease-in-out infinite alternate;
        }

        @keyframes breathe {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-top: 20px;
            margin-bottom: 40px;
            box-shadow: 0 20px 60px rgba(0, 255, 255, 0.15);
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 255, 255, 0.2);
        }

        .header h1 {
            color: #00ffff !important;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 4px 20px rgba(0, 255, 255, 0.6);
        }

        .header p {
            color: #94a3b8;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .ai-disclaimer {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2) 0%, rgba(255, 142, 83, 0.2) 100%);
            border: 2px solid rgba(255, 107, 107, 0.4);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.3);
        }

        .ai-disclaimer h2 {
            color: #FF6B6B !important;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .important-notice {
            background: rgba(255, 193, 7, 0.15);
            border-left: 5px solid #FFD700;
            padding: 25px;
            margin: 25px 0;
            border-radius: 8px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .important-notice h3 {
            color: #FFD700 !important;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .terms-summary {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        .terms-summary h3 {
            color: #00ffff !important;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        ul {
            padding-left: 20px;
            margin: 15px 0;
        }

        li {
            margin: 12px 0;
            color: #cbd5e1;
            line-height: 1.5;
        }

        li strong {
            color: #00ffff;
        }

        .acceptance-section {
            background: rgba(34, 211, 238, 0.1);
            border: 2px solid rgba(34, 211, 238, 0.4);
            border-radius: 16px;
            padding: 30px;
            margin: 40px 0;
            text-align: center;
        }

        .acceptance-checkboxes {
            text-align: left;
            max-width: 600px;
            margin: 30px auto;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            accent-color: #00ffff;
            cursor: pointer;
        }

        .checkbox-item label {
            color: #e2e8f0;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
            line-height: 1.4;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn-accept {
            background: linear-gradient(135deg, #00ffff 0%, #0891b2 100%);
            color: #000000;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.5;
            pointer-events: none;
        }

        .btn-accept.enabled {
            opacity: 1;
            pointer-events: all;
        }

        .btn-accept.enabled:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.6);
            background: linear-gradient(135deg, #22d3ee 0%, #0891b2 100%);
        }

        .btn-decline {
            background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(248, 113, 113, 0.4);
        }

        .btn-decline:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(248, 113, 113, 0.6);
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        }

        .read-full-terms {
            text-align: center;
            margin: 30px 0;
        }

        .read-full-terms a {
            color: #22d3ee;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: 1px solid rgba(34, 211, 238, 0.3);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .read-full-terms a:hover {
            background: rgba(34, 211, 238, 0.1);
            border-color: #22d3ee;
            transform: translateY(-1px);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #00ffff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn-accept, .btn-decline {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-handshake"></i> Welcome to SoulBridge AI</h1>
            <p>Before we continue, you must read and agree to our terms and AI tool disclaimers</p>
        </div>

        <!-- AI Tool Disclaimer -->
        <div class="ai-disclaimer">
            <h2><i class="fas fa-brain"></i> SoulBridge AI is an AI-Powered Emotional Support Tool</h2>
            
            <p>SoulBridge AI uses artificial intelligence to help you express thoughts, process emotions, and explore your inner world. While it may feel personal and insightful, all responses are generated by an AI model and may include errors, incomplete information, or unexpected behavior.</p>

            <div class="important-notice">
                <h3><i class="fas fa-exclamation-triangle"></i> Critical Important Notice:</h3>
                <ul>
                    <li><strong>SoulBridge AI is NOT a licensed therapist, counselor, or medical professional</strong></li>
                    <li><strong>It is NOT a substitute for professional help in mental health, legal, financial, or medical matters</strong></li>
                    <li><strong>Always consult a qualified professional for serious or urgent concerns</strong></li>
                    <li><strong>In a mental health emergency, contact 988 (Suicide Prevention Lifeline) or your local emergency services</strong></li>
                </ul>
            </div>
        </div>

        <!-- Terms Summary -->
        <div class="terms-summary">
            <h3><i class="fas fa-file-contract"></i> By Using SoulBridge AI, You Agree To:</h3>
            <ul>
                <li>Use it for <strong>self-expression, creativity, or entertainment only</strong></li>
                <li>Avoid sharing highly sensitive personal data (legal cases, medical details, account credentials)</li>
                <li>Accept that your interactions may be used to improve the service (respecting our Privacy Policy)</li>
                <li>Use the service responsibly and in accordance with applicable laws</li>
                <li>Understand that <strong>AI responses are generated content and may contain errors</strong></li>
                <li>Not use the service for harmful, illegal, or malicious purposes</li>
            </ul>
        </div>

        <!-- Read Full Terms Link -->
        <div class="read-full-terms">
            <a href="/terms" target="_blank">
                <i class="fas fa-external-link-alt"></i>
                Read Complete Terms & Privacy Policy
            </a>
        </div>

        <!-- Acceptance Section -->
        <div class="acceptance-section">
            <h2 style="color: #00ffff; margin-bottom: 25px;">
                <i class="fas fa-check-circle"></i> Required Acknowledgments
            </h2>
            
            <div class="acceptance-checkboxes">
                <div class="checkbox-item">
                    <input type="checkbox" id="ai-understanding" required>
                    <label for="ai-understanding">
                        <strong>I understand that SoulBridge AI is an AI tool and NOT professional therapy, medical, or legal advice.</strong> I will consult qualified professionals for serious concerns.
                    </label>
                </div>

                <div class="checkbox-item">
                    <input type="checkbox" id="terms-privacy" required>
                    <label for="terms-privacy">
                        I have read and agree to the <strong>Terms of Service and Privacy Policy</strong>. I understand how my data will be used and protected.
                    </label>
                </div>

                <div class="checkbox-item">
                    <input type="checkbox" id="age-confirmation" required>
                    <label for="age-confirmation">
                        I confirm that I am <strong>at least 13 years old</strong> (or have parental consent if under 18) and legally able to agree to these terms.
                    </label>
                </div>

                <div class="checkbox-item">
                    <input type="checkbox" id="responsible-use" required>
                    <label for="responsible-use">
                        I agree to use SoulBridge AI <strong>responsibly for entertainment and self-reflection</strong>, not for critical decisions or emergency situations.
                    </label>
                </div>
            </div>

            <div class="action-buttons">
                <button id="acceptBtn" class="btn-accept" onclick="acceptTerms()" disabled>
                    <i class="fas fa-check"></i> Accept & Continue to SoulBridge AI
                </button>
                
                <button id="declineBtn" class="btn-decline" onclick="declineTerms()">
                    <i class="fas fa-times"></i> Decline & Sign Out
                </button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Processing your acceptance...</p>
        </div>
    </div>

    <script>
        // Check all required checkboxes
        function checkAllBoxes() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][required]');
            const acceptBtn = document.getElementById('acceptBtn');
            
            let allChecked = true;
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    allChecked = false;
                }
            });
            
            acceptBtn.disabled = !allChecked;
            if (allChecked) {
                acceptBtn.classList.add('enabled');
            } else {
                acceptBtn.classList.remove('enabled');
            }
        }

        // Add event listeners to all checkboxes
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][required]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', checkAllBoxes);
            });
        });

        // Accept terms function
        async function acceptTerms() {
            const loading = document.getElementById('loading');
            const acceptBtn = document.getElementById('acceptBtn');
            const declineBtn = document.getElementById('declineBtn');
            
            // Show loading
            loading.style.display = 'block';
            acceptBtn.disabled = true;
            declineBtn.disabled = true;
            
            try {
                const response = await fetch('/api/accept-terms', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ai_understanding: document.getElementById('ai-understanding').checked,
                        terms_privacy: document.getElementById('terms-privacy').checked,
                        age_confirmation: document.getElementById('age-confirmation').checked,
                        responsible_use: document.getElementById('responsible-use').checked,
                        acceptance_date: new Date().toISOString()
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Store acceptance in localStorage as well
                    localStorage.setItem('terms-accepted', 'true');
                    localStorage.setItem('terms-acceptance-date', new Date().toISOString());
                    
                    // Show success message briefly then redirect
                    loading.innerHTML = '<div class="spinner"></div><p style="color: #00ffff;">✅ Terms accepted! Redirecting to SoulBridge AI...</p>';
                    
                    setTimeout(() => {
                        window.location.href = '/intro';
                    }, 2000);
                } else {
                    alert('Failed to save terms acceptance. Please try again.');
                    loading.style.display = 'none';
                    acceptBtn.disabled = false;
                    declineBtn.disabled = false;
                }
            } catch (error) {
                console.error('Terms acceptance error:', error);
                alert('Network error. Please check your connection and try again.');
                loading.style.display = 'none';
                acceptBtn.disabled = false;
                declineBtn.disabled = false;
            }
        }

        // Decline terms function
        function declineTerms() {
            if (confirm('Are you sure you want to decline? This will sign you out and you cannot use SoulBridge AI without accepting the terms.')) {
                // Clear any stored session data
                localStorage.clear();
                sessionStorage.clear();
                
                // Sign out and redirect to login
                fetch('/auth/logout').then(() => {
                    window.location.href = '/login?message=terms_declined';
                });
            }
        }

        // Prevent user from navigating away without accepting
        window.addEventListener('beforeunload', function(e) {
            if (!localStorage.getItem('terms-accepted')) {
                e.preventDefault();
                e.returnValue = 'You must accept the terms to use SoulBridge AI. Are you sure you want to leave?';
            }
        });
    </script>
</body>
</html>