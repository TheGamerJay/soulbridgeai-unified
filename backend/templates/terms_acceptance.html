<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accept Terms to Continue - SoulBridge AI</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <meta name="theme-color" content="#00ffff">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}?v={{ range(1000000) | random }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <style>
        /* Terms Acceptance Page Styling */
        html, body {
            background: #000000 !important;
            color: #e2e8f0 !important;
            font-family: system-ui, -apple-system, sans-serif !important;
            margin: 0 !important;
            padding: 0 !important;
            line-height: 1.6;
            overflow-x: hidden;
        }

        /* Stunning cyan animated background */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 15% 25%, rgba(0, 255, 255, 0.1) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(0, 255, 255, 0.08) 0%, transparent 45%),
                radial-gradient(circle at 45% 85%, rgba(0, 255, 255, 0.06) 0%, transparent 35%);
            pointer-events: none;
            z-index: -1;
            animation: breathe 4s ease-in-out infinite alternate;
        }

        @keyframes breathe {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            margin-top: 20px;
            margin-bottom: 40px;
            box-shadow: 0 20px 60px rgba(0, 255, 255, 0.15);
            border: 1px solid rgba(0, 255, 255, 0.2);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid rgba(0, 255, 255, 0.2);
        }

        .header h1 {
            color: #00ffff !important;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 0 4px 20px rgba(0, 255, 255, 0.6);
        }

        .header p {
            color: #94a3b8;
            font-size: 1.1rem;
            max-width: 600px;
            margin: 0 auto;
        }

        .ai-disclaimer {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.2) 0%, rgba(255, 142, 83, 0.2) 100%);
            border: 2px solid rgba(255, 107, 107, 0.4);
            border-radius: 16px;
            padding: 30px;
            margin: 30px 0;
            backdrop-filter: blur(10px);
            box-shadow: 0 8px 30px rgba(255, 107, 107, 0.3);
        }

        .ai-disclaimer h2 {
            color: #FF6B6B !important;
            margin-top: 0;
            margin-bottom: 20px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .important-notice {
            background: rgba(255, 193, 7, 0.15);
            border-left: 5px solid #FFD700;
            padding: 25px;
            margin: 25px 0;
            border-radius: 8px;
            border: 1px solid rgba(255, 193, 7, 0.3);
        }

        .important-notice h3 {
            color: #FFD700 !important;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.3rem;
        }

        .terms-summary {
            background: rgba(0, 255, 255, 0.1);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 25px;
            margin: 25px 0;
        }

        .terms-summary h3 {
            color: #00ffff !important;
            margin-top: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        ul {
            padding-left: 20px;
            margin: 15px 0;
        }

        li {
            margin: 12px 0;
            color: #cbd5e1;
            line-height: 1.5;
        }

        li strong {
            color: #00ffff;
        }

        .acceptance-section {
            background: rgba(34, 211, 238, 0.1);
            border: 2px solid rgba(34, 211, 238, 0.4);
            border-radius: 16px;
            padding: 30px;
            margin: 40px 0;
            text-align: center;
        }

        .acceptance-checkboxes {
            text-align: left;
            max-width: 600px;
            margin: 30px auto;
        }

        .checkbox-item {
            display: flex;
            align-items: flex-start;
            gap: 15px;
            margin: 20px 0;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            width: 20px;
            height: 20px;
            margin-top: 2px;
            accent-color: #00ffff;
            cursor: pointer;
        }

        .checkbox-item label {
            color: #e2e8f0;
            font-weight: 500;
            cursor: pointer;
            flex: 1;
            line-height: 1.4;
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        .btn-accept {
            background: linear-gradient(135deg, #00ffff 0%, #0891b2 100%);
            color: #000000;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 255, 255, 0.4);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            opacity: 0.5;
            pointer-events: none;
        }

        .btn-accept.enabled {
            opacity: 1;
            pointer-events: all;
        }

        .btn-accept.enabled:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 255, 255, 0.6);
            background: linear-gradient(135deg, #22d3ee 0%, #0891b2 100%);
        }

        .btn-decline {
            background: linear-gradient(135deg, #f87171 0%, #dc2626 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 25px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(248, 113, 113, 0.4);
        }

        .btn-decline:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(248, 113, 113, 0.6);
            background: linear-gradient(135deg, #dc2626 0%, #991b1b 100%);
        }

        .read-full-terms {
            text-align: center;
            margin: 30px 0;
        }

        .read-full-terms a {
            color: #22d3ee;
            text-decoration: none;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 20px;
            border: 1px solid rgba(34, 211, 238, 0.3);
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .read-full-terms a:hover {
            background: rgba(34, 211, 238, 0.1);
            border-color: #22d3ee;
            transform: translateY(-1px);
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid rgba(0, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 4px solid #00ffff;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Language Selector */
        .language-selector {
            background: rgba(34, 211, 238, 0.1);
            border: 2px solid rgba(34, 211, 238, 0.3);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }

        .language-selector h3 {
            color: #22d3ee !important;
            margin: 0 0 15px 0;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .language-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 15px;
        }

        .lang-btn {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            color: #00ffff;
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            font-weight: 500;
        }

        .lang-btn:hover {
            background: rgba(0, 255, 255, 0.2);
            border-color: #00ffff;
            transform: translateY(-1px);
        }

        .lang-btn.active {
            background: linear-gradient(135deg, #00ffff 0%, #0891b2 100%);
            color: #000;
            border-color: #00ffff;
        }

        .translation-notice {
            background: rgba(255, 193, 7, 0.1);
            border: 1px solid rgba(255, 193, 7, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        .translation-notice strong {
            color: #FFD700;
        }

        /* Google Translate Widget Styling */
        .goog-te-gadget {
            font-family: inherit !important;
            color: #e2e8f0 !important;
        }

        .goog-te-gadget .goog-te-combo {
            background: rgba(0, 0, 0, 0.8) !important;
            border: 1px solid rgba(0, 255, 255, 0.3) !important;
            border-radius: 8px !important;
            color: #e2e8f0 !important;
            padding: 8px !important;
            font-size: 0.9rem !important;
        }

        /* Hide Google Translate branding */
        .goog-te-banner-frame { display: none !important; }
        .goog-te-balloon-frame { display: none !important; }
        body { top: 0 !important; }

        /* Responsive design */
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }

            .btn-accept, .btn-decline {
                width: 100%;
                max-width: 300px;
            }

            .language-buttons {
                gap: 8px;
            }

            .lang-btn {
                padding: 6px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><i class="fas fa-handshake"></i> Welcome to SoulBridge AI</h1>
            <p>Before we continue, you must read and agree to our terms and AI tool disclaimers</p>
        </div>

        <!-- Language Selector -->
        <div class="language-selector">
            <h3><i class="fas fa-globe"></i> Choose Your Language / Selecciona tu idioma / Choisissez votre langue</h3>
            
            <div class="language-buttons">
                <button class="lang-btn active" onclick="translatePage('en')" data-lang="en">
                    🇺🇸 English
                </button>
                <button class="lang-btn" onclick="translatePage('es')" data-lang="es">
                    🇪🇸 Español
                </button>
                <button class="lang-btn" onclick="translatePage('fr')" data-lang="fr">
                    🇫🇷 Français
                </button>
                <button class="lang-btn" onclick="translatePage('de')" data-lang="de">
                    🇩🇪 Deutsch
                </button>
                <button class="lang-btn" onclick="translatePage('pt')" data-lang="pt">
                    🇧🇷 Português
                </button>
                <button class="lang-btn" onclick="translatePage('zh')" data-lang="zh">
                    🇨🇳 中文
                </button>
                <button class="lang-btn" onclick="translatePage('ja')" data-lang="ja">
                    🇯🇵 日本語
                </button>
                <button class="lang-btn" onclick="translatePage('ko')" data-lang="ko">
                    🇰🇷 한국어
                </button>
                <button class="lang-btn" onclick="translatePage('ar')" data-lang="ar">
                    🇸🇦 العربية
                </button>
                <button class="lang-btn" onclick="translatePage('hi')" data-lang="hi">
                    🇮🇳 हिन्दी
                </button>
                <button class="lang-btn" onclick="translatePage('ru')" data-lang="ru">
                    🇷🇺 Русский
                </button>
                <button class="lang-btn" onclick="translatePage('it')" data-lang="it">
                    🇮🇹 Italiano
                </button>
            </div>

            <!-- Google Translate Widget (Visible for debugging) -->
            <div id="google_translate_element" style="background: rgba(0,0,0,0.8); padding: 10px; border-radius: 8px; margin: 10px 0;"></div>
            <p style="font-size: 0.8rem; color: #888;">⬆️ Native Google Translate widget (for debugging)</p>

            <div class="translation-notice">
                <strong>⚠️ Important:</strong> Translations are provided by Google Translate for accessibility. 
                The English version is legally binding. Please ensure you understand the terms before accepting.
                <br><br>
                <strong>重要:</strong> 翻译由Google翻译提供。英文版本具有法律约束力。
                <br>
                <strong>Importante:</strong> Las traducciones son proporcionadas por Google Translate. La versión en inglés es legalmente vinculante.
                <br><br>
                <!-- Debug buttons (remove in production) -->
                <button type="button" onclick="debugTranslation()" style="background: rgba(255,255,255,0.1); border: 1px solid #ccc; padding: 5px 10px; margin: 5px; border-radius: 4px; color: #ccc; font-size: 0.8rem;">
                    🔍 Debug Translation
                </button>
                <button type="button" onclick="refreshTranslation()" style="background: rgba(255,255,255,0.1); border: 1px solid #ccc; padding: 5px 10px; margin: 5px; border-radius: 4px; color: #ccc; font-size: 0.8rem;">
                    🔄 Refresh Translation
                </button>
            </div>
        </div>

        <!-- AI Tool Disclaimer -->
        <div class="ai-disclaimer">
            <h2><i class="fas fa-brain"></i> SoulBridge AI is an AI-Powered Emotional Support Tool</h2>
            
            <p>SoulBridge AI uses artificial intelligence to help you express thoughts, process emotions, and explore your inner world. While it may feel personal and insightful, all responses are generated by an AI model and may include errors, incomplete information, or unexpected behavior.</p>

            <div class="important-notice">
                <h3><i class="fas fa-exclamation-triangle"></i> Critical Important Notice:</h3>
                <ul>
                    <li><strong>SoulBridge AI is NOT a licensed therapist, counselor, or medical professional</strong></li>
                    <li><strong>It is NOT a substitute for professional help in mental health, legal, financial, or medical matters</strong></li>
                    <li><strong>Always consult a qualified professional for serious or urgent concerns</strong></li>
                    <li><strong>In a mental health emergency, contact 988 (Suicide Prevention Lifeline) or your local emergency services</strong></li>
                </ul>
            </div>
        </div>

        <!-- Terms Summary -->
        <div class="terms-summary">
            <h3><i class="fas fa-file-contract"></i> By Using SoulBridge AI, You Agree To:</h3>
            <ul>
                <li>Use it for <strong>self-expression, creativity, or entertainment only</strong></li>
                <li>Avoid sharing highly sensitive personal data (legal cases, medical details, account credentials)</li>
                <li>Accept that your interactions may be used to improve the service (respecting our Privacy Policy)</li>
                <li>Use the service responsibly and in accordance with applicable laws</li>
                <li>Understand that <strong>AI responses are generated content and may contain errors</strong></li>
                <li>Not use the service for harmful, illegal, or malicious purposes</li>
            </ul>
        </div>

        <!-- Read Full Terms Link -->
        <div class="read-full-terms">
            <a href="/terms" target="_blank">
                <i class="fas fa-external-link-alt"></i>
                Read Complete Terms & Privacy Policy
            </a>
        </div>

        <!-- Acceptance Section -->
        <div class="acceptance-section">
            <h2 style="color: #00ffff; margin-bottom: 25px;">
                <i class="fas fa-check-circle"></i> Required Acknowledgments
            </h2>
            
            <div class="acceptance-checkboxes">
                <div class="checkbox-item">
                    <input type="checkbox" id="ai-understanding" required>
                    <label for="ai-understanding">
                        <strong>I understand that SoulBridge AI is an AI tool and NOT professional therapy, medical, or legal advice.</strong> I will consult qualified professionals for serious concerns.
                    </label>
                </div>

                <div class="checkbox-item">
                    <input type="checkbox" id="terms-privacy" required>
                    <label for="terms-privacy">
                        I have read and agree to the <strong>Terms of Service and Privacy Policy</strong>. I understand how my data will be used and protected.
                    </label>
                </div>

                <div class="checkbox-item">
                    <input type="checkbox" id="age-confirmation" required>
                    <label for="age-confirmation">
                        I confirm that I am <strong>at least 13 years old</strong> (or have parental consent if under 18) and legally able to agree to these terms.
                    </label>
                </div>

                <div class="checkbox-item">
                    <input type="checkbox" id="responsible-use" required>
                    <label for="responsible-use">
                        I agree to use SoulBridge AI <strong>responsibly for entertainment and self-reflection</strong>, not for critical decisions or emergency situations.
                    </label>
                </div>
            </div>

            <div class="action-buttons">
                <button id="acceptBtn" class="btn-accept" onclick="acceptTerms()" disabled>
                    <i class="fas fa-check"></i> Accept & Continue to SoulBridge AI
                </button>
                
                <button id="declineBtn" class="btn-decline" onclick="declineTerms()">
                    <i class="fas fa-times"></i> Decline & Sign Out
                </button>
            </div>
        </div>

        <!-- Loading Indicator -->
        <div class="loading" id="loading">
            <div class="spinner"></div>
            <p>Processing your acceptance...</p>
        </div>
    </div>

    <script>
        // Check all required checkboxes
        function checkAllBoxes() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][required]');
            const acceptBtn = document.getElementById('acceptBtn');
            
            let allChecked = true;
            checkboxes.forEach(checkbox => {
                if (!checkbox.checked) {
                    allChecked = false;
                }
            });
            
            acceptBtn.disabled = !allChecked;
            if (allChecked) {
                acceptBtn.classList.add('enabled');
            } else {
                acceptBtn.classList.remove('enabled');
            }
        }

        // Add event listeners to all checkboxes
        document.addEventListener('DOMContentLoaded', function() {
            const checkboxes = document.querySelectorAll('input[type="checkbox"][required]');
            checkboxes.forEach(checkbox => {
                checkbox.addEventListener('change', checkAllBoxes);
            });
        });

        // Accept terms function
        async function acceptTerms() {
            const loading = document.getElementById('loading');
            const acceptBtn = document.getElementById('acceptBtn');
            const declineBtn = document.getElementById('declineBtn');
            
            // Show loading
            loading.style.display = 'block';
            acceptBtn.disabled = true;
            declineBtn.disabled = true;
            
            try {
                const response = await fetch('/api/accept-terms', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ai_understanding: document.getElementById('ai-understanding').checked,
                        terms_privacy: document.getElementById('terms-privacy').checked,
                        age_confirmation: document.getElementById('age-confirmation').checked,
                        responsible_use: document.getElementById('responsible-use').checked,
                        acceptance_date: new Date().toISOString()
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Store acceptance in localStorage as well
                    localStorage.setItem('terms-accepted', 'true');
                    localStorage.setItem('terms-acceptance-date', new Date().toISOString());
                    
                    // Show success message briefly then redirect
                    loading.innerHTML = '<div class="spinner"></div><p style="color: #00ffff;">✅ Terms accepted! Redirecting to SoulBridge AI...</p>';
                    
                    setTimeout(() => {
                        window.location.href = '/intro';
                    }, 2000);
                } else {
                    alert('Failed to save terms acceptance. Please try again.');
                    loading.style.display = 'none';
                    acceptBtn.disabled = false;
                    declineBtn.disabled = false;
                }
            } catch (error) {
                console.error('Terms acceptance error:', error);
                alert('Network error. Please check your connection and try again.');
                loading.style.display = 'none';
                acceptBtn.disabled = false;
                declineBtn.disabled = false;
            }
        }

        // Decline terms function
        function declineTerms() {
            if (confirm('Are you sure you want to decline? This will sign you out and you cannot use SoulBridge AI without accepting the terms.')) {
                // Clear any stored session data
                localStorage.clear();
                sessionStorage.clear();
                
                // Sign out and redirect to login
                fetch('/auth/logout').then(() => {
                    window.location.href = '/login?message=terms_declined';
                });
            }
        }

        // Prevent user from navigating away without accepting
        window.addEventListener('beforeunload', function(e) {
            if (!localStorage.getItem('terms-accepted')) {
                e.preventDefault();
                e.returnValue = 'You must accept the terms to use SoulBridge AI. Are you sure you want to leave?';
            }
        });
    </script>

    <!-- Google Translate Script -->
    <script type="text/javascript">
        function googleTranslateElementInit() {
            new google.translate.TranslateElement({
                pageLanguage: 'en',
                includedLanguages: 'en,es,fr,de,pt,zh-cn,ja,ko,ar,hi,ru,it,nl,sv,da,no,fi,pl,tr,th,vi,id,ms,tl',
                layout: google.translate.TranslateElement.InlineLayout.SIMPLE,
                autoDisplay: false,
                multilanguagePage: true
            }, 'google_translate_element');
        }

        // Ensure Google Translate loads
        window.addEventListener('load', function() {
            if (typeof google === 'undefined' || typeof google.translate === 'undefined') {
                console.warn('Google Translate failed to load, falling back to manual translations');
                window.googleTranslateLoaded = false;
            } else {
                window.googleTranslateLoaded = true;
                console.log('Google Translate loaded successfully');
            }
        });
    </script>
    <script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>

    <!-- Translation Functionality -->
    <script>
        let currentLanguage = 'en';
        
        // Language translations for key phrases that need to be clear
        const translations = {
            'en': {
                'accept_button': 'Accept & Continue to SoulBridge AI',
                'decline_button': 'Decline & Sign Out',
                'processing': 'Processing your acceptance...',
                'success': '✅ Terms accepted! Redirecting to SoulBridge AI...',
                'checkbox_ai': 'I understand that SoulBridge AI is an AI tool and NOT professional therapy, medical, or legal advice. I will consult qualified professionals for serious concerns.',
                'checkbox_terms': 'I have read and agree to the Terms of Service and Privacy Policy. I understand how my data will be used and protected.',
                'checkbox_age': 'I confirm that I am at least 13 years old (or have parental consent if under 18) and legally able to agree to these terms.',
                'checkbox_use': 'I agree to use SoulBridge AI responsibly for entertainment and self-reflection, not for critical decisions or emergency situations.'
            },
            'es': {
                'accept_button': 'Aceptar y Continuar a SoulBridge AI',
                'decline_button': 'Rechazar y Cerrar Sesión',
                'processing': 'Procesando su aceptación...',
                'success': '✅ ¡Términos aceptados! Redirigiendo a SoulBridge AI...',
                'checkbox_ai': 'Entiendo que SoulBridge AI es una herramienta de IA y NO es terapia profesional, médica o legal. Consultaré a profesionales calificados para asuntos serios.',
                'checkbox_terms': 'He leído y acepto los Términos de Servicio y la Política de Privacidad. Entiendo cómo se usarán y protegerán mis datos.',
                'checkbox_age': 'Confirmo que tengo al menos 13 años (o consentimiento parental si soy menor de 18) y puedo legalmente aceptar estos términos.',
                'checkbox_use': 'Acepto usar SoulBridge AI responsablemente para entretenimiento y autorreflexión, no para decisiones críticas o emergencias.'
            },
            'fr': {
                'accept_button': 'Accepter et Continuer vers SoulBridge AI',
                'decline_button': 'Refuser et Se Déconnecter',
                'processing': 'Traitement de votre acceptation...',
                'success': '✅ Conditions acceptées! Redirection vers SoulBridge AI...',
                'checkbox_ai': 'Je comprends que SoulBridge AI est un outil IA et NON une thérapie professionnelle, médicale ou légale. Je consulterai des professionnels qualifiés pour les préoccupations sérieuses.',
                'checkbox_terms': 'J\'ai lu et accepte les Conditions de Service et la Politique de Confidentialité. Je comprends comment mes données seront utilisées et protégées.',
                'checkbox_age': 'Je confirme avoir au moins 13 ans (ou consentement parental si moins de 18 ans) et pouvoir légalement accepter ces conditions.',
                'checkbox_use': 'J\'accepte d\'utiliser SoulBridge AI de manière responsable pour le divertissement et la réflexion personnelle, pas pour des décisions critiques ou des urgences.'
            }
            // Add more languages as needed
        };

        function translatePage(langCode) {
            console.log(`Attempting to translate to: ${langCode}`);
            
            // Update active button
            document.querySelectorAll('.lang-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.lang === langCode) {
                    btn.classList.add('active');
                }
            });

            currentLanguage = langCode;
            
            // Store language preference
            localStorage.setItem('preferred-language', langCode);

            if (langCode === 'en') {
                // Reset to English - reload page to clear translations
                window.location.reload();
                return;
            }

            // Show translation status immediately
            showTranslationStatus(langCode);

            // Try Google Translate first
            setTimeout(() => {
                const selectElement = document.querySelector('.goog-te-combo');
                if (selectElement && window.googleTranslateLoaded) {
                    console.log('Using Google Translate');
                    
                    // Map language codes for Google Translate
                    const langMapping = {
                        'zh': 'zh-cn',
                        'pt': 'pt',
                        'es': 'es',
                        'fr': 'fr',
                        'de': 'de',
                        'ja': 'ja',
                        'ko': 'ko',
                        'ar': 'ar',
                        'hi': 'hi',
                        'ru': 'ru',
                        'it': 'it'
                    };
                    
                    const googleLangCode = langMapping[langCode] || langCode;
                    selectElement.value = googleLangCode;
                    selectElement.dispatchEvent(new Event('change'));
                    
                    // Wait for translation to complete, then apply custom translations
                    setTimeout(() => {
                        applyCustomTranslations(langCode);
                    }, 2000);
                } else {
                    console.log('Google Translate not available, using manual translation');
                    applyManualTranslation(langCode);
                }
            }, 500);
        }

        function applyCustomTranslations(langCode) {
            // Apply our specific translations over Google Translate for critical elements
            if (translations[langCode]) {
                const trans = translations[langCode];
                
                // Update buttons
                const acceptBtn = document.querySelector('.btn-accept');
                const declineBtn = document.querySelector('.btn-decline');
                
                if (acceptBtn) {
                    acceptBtn.innerHTML = `<i class="fas fa-check"></i> ${trans.accept_button}`;
                }
                if (declineBtn) {
                    declineBtn.innerHTML = `<i class="fas fa-times"></i> ${trans.decline_button}`;
                }
            }
        }

        function applyManualTranslation(langCode) {
            // Fallback: Apply manual translations when Google Translate fails
            if (!translations[langCode]) {
                console.warn(`No manual translation available for ${langCode}`);
                return;
            }

            const trans = translations[langCode];

            // Translate key elements manually
            const elements = {
                '.header h1': getManualTranslation(langCode, 'welcome_title', 'Welcome to SoulBridge AI'),
                '.header p': getManualTranslation(langCode, 'welcome_subtitle', 'Before we continue, you must read and agree to our terms and AI tool disclaimers'),
                '.btn-accept': `<i class="fas fa-check"></i> ${trans.accept_button}`,
                '.btn-decline': `<i class="fas fa-times"></i> ${trans.decline_button}`,
                '#ai-understanding + label': trans.checkbox_ai,
                '#terms-privacy + label': trans.checkbox_terms,
                '#age-confirmation + label': trans.checkbox_age,
                '#responsible-use + label': trans.checkbox_use
            };

            Object.entries(elements).forEach(([selector, text]) => {
                const element = document.querySelector(selector);
                if (element && text) {
                    if (selector.includes('btn-')) {
                        element.innerHTML = text;
                    } else {
                        element.textContent = text;
                    }
                }
            });

            console.log(`Applied manual translation for ${langCode}`);
        }

        function getManualTranslation(langCode, key, fallback) {
            const manualTranslations = {
                'es': {
                    'welcome_title': 'Bienvenido a SoulBridge AI',
                    'welcome_subtitle': 'Antes de continuar, debe leer y aceptar nuestros términos y avisos de herramientas de IA'
                },
                'fr': {
                    'welcome_title': 'Bienvenue sur SoulBridge AI',
                    'welcome_subtitle': 'Avant de continuer, vous devez lire et accepter nos conditions et avis d\'outils IA'
                },
                'de': {
                    'welcome_title': 'Willkommen bei SoulBridge AI',
                    'welcome_subtitle': 'Bevor wir fortfahren, müssen Sie unsere Bedingungen und KI-Tool-Haftungsausschlüsse lesen und akzeptieren'
                }
            };
            
            return manualTranslations[langCode]?.[key] || fallback;
        }

        function showTranslationStatus(langCode) {
            // Remove existing status
            const existingStatus = document.querySelector('.translation-status');
            if (existingStatus) {
                existingStatus.remove();
            }

            // Add status indicator
            const status = document.createElement('div');
            status.className = 'translation-status';
            status.style.cssText = `
                position: fixed;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 193, 7, 0.9);
                color: #000;
                padding: 8px 16px;
                border-radius: 20px;
                font-size: 0.8rem;
                font-weight: 600;
                z-index: 9999;
                animation: fadeInOut 4s ease-in-out;
            `;
            
            const langNames = {
                'es': 'Español', 'fr': 'Français', 'de': 'Deutsch', 'pt': 'Português',
                'zh': '中文', 'ja': '日本語', 'ko': '한국어', 'ar': 'العربية',
                'hi': 'हिन्दी', 'ru': 'Русский', 'it': 'Italiano'
            };
            
            status.innerHTML = `🌐 Translating to ${langNames[langCode] || langCode.toUpperCase()}... English version is legally binding.`;
            document.body.appendChild(status);

            // Add animation style
            if (!document.querySelector('#translation-animations')) {
                const style = document.createElement('style');
                style.id = 'translation-animations';
                style.textContent = `
                    @keyframes fadeInOut {
                        0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                        20%, 80% { opacity: 1; transform: translateX(-50%) translateY(0); }
                        100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
                    }
                `;
                document.head.appendChild(style);
            }

            // Remove after animation
            setTimeout(() => {
                if (status.parentNode) {
                    status.remove();
                }
            }, 4000);
        }

        // Load saved language preference
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, checking for saved language...');
            
            // Wait for Google Translate to load
            let checkCount = 0;
            const checkGoogleTranslate = setInterval(() => {
                checkCount++;
                const translateElement = document.querySelector('#google_translate_element');
                const selectElement = document.querySelector('.goog-te-combo');
                
                console.log(`Check ${checkCount}: Google Translate element exists:`, !!translateElement);
                console.log(`Check ${checkCount}: Select element exists:`, !!selectElement);
                
                if (selectElement || checkCount > 20) { // Max 10 seconds
                    clearInterval(checkGoogleTranslate);
                    
                    if (selectElement) {
                        window.googleTranslateLoaded = true;
                        console.log('Google Translate fully loaded');
                        
                        // Apply saved language
                        const savedLang = localStorage.getItem('preferred-language');
                        if (savedLang && savedLang !== 'en') {
                            console.log('Applying saved language:', savedLang);
                            setTimeout(() => {
                                translatePage(savedLang);
                            }, 500);
                        }
                    } else {
                        window.googleTranslateLoaded = false;
                        console.warn('Google Translate failed to load after 10 seconds');
                    }
                }
            }, 500);
        });

        // Add debugging function
        function debugTranslation() {
            console.log('=== Translation Debug ===');
            console.log('Current language:', currentLanguage);
            console.log('Google Translate loaded:', window.googleTranslateLoaded);
            console.log('Google Translate element exists:', !!document.querySelector('.goog-te-combo'));
            console.log('Available translations:', Object.keys(translations));
        }

        // Add manual refresh translation function
        function refreshTranslation() {
            if (currentLanguage !== 'en') {
                console.log('Refreshing translation for:', currentLanguage);
                translatePage(currentLanguage);
            }
        }

        // Enhanced accept terms function with translation support
        const originalAcceptTerms = window.acceptTerms;
        window.acceptTerms = async function() {
            const loading = document.getElementById('loading');
            const acceptBtn = document.getElementById('acceptBtn');
            const declineBtn = document.getElementById('declineBtn');
            
            // Show loading with translation
            loading.style.display = 'block';
            acceptBtn.disabled = true;
            declineBtn.disabled = true;

            const trans = translations[currentLanguage] || translations['en'];
            loading.innerHTML = `<div class="spinner"></div><p>${trans.processing}</p>`;
            
            try {
                const response = await fetch('/api/accept-terms', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ai_understanding: document.getElementById('ai-understanding').checked,
                        terms_privacy: document.getElementById('terms-privacy').checked,
                        age_confirmation: document.getElementById('age-confirmation').checked,
                        responsible_use: document.getElementById('responsible-use').checked,
                        acceptance_date: new Date().toISOString(),
                        language_used: currentLanguage // Track language used for acceptance
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    // Store acceptance in localStorage as well
                    localStorage.setItem('terms-accepted', 'true');
                    localStorage.setItem('terms-acceptance-date', new Date().toISOString());
                    localStorage.setItem('terms-language', currentLanguage);
                    
                    // Show success message with translation
                    loading.innerHTML = `<div class="spinner"></div><p style="color: #00ffff;">${trans.success}</p>`;
                    
                    setTimeout(() => {
                        window.location.href = '/intro';
                    }, 2000);
                } else {
                    alert('Failed to save terms acceptance. Please try again.');
                    loading.style.display = 'none';
                    acceptBtn.disabled = false;
                    declineBtn.disabled = false;
                }
            } catch (error) {
                console.error('Terms acceptance error:', error);
                alert('Network error. Please check your connection and try again.');
                loading.style.display = 'none';
                acceptBtn.disabled = false;
                declineBtn.disabled = false;
            }
        };
    </script>
</body>
</html>