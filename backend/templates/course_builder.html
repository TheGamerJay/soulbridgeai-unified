<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Course Builder - SoulBridge AI</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .course-builder-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #2d3748;
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            color: #718096;
            font-size: 1.1rem;
        }

        .course-builder-tabs {
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 8px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: transparent;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            white-space: nowrap;
            min-width: 140px;
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }

        .tab-content {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
            font-size: 1rem;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-danger {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }

        .module-builder {
            border: 2px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            background: #f8fafc;
        }

        .module-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e2e8f0;
        }

        .module-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d3748;
        }

        .lesson-item {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        .lesson-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .lesson-controls {
            display: flex;
            gap: 10px;
        }

        .lesson-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .drag-drop-area {
            border: 2px dashed #cbd5e0;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .drag-drop-area:hover {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.05);
        }

        .drag-drop-area.active {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.1);
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
        }

        .course-preview {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
        }

        .preview-header {
            text-align: center;
            margin-bottom: 25px;
        }

        .preview-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }

        .preview-meta {
            display: flex;
            justify-content: center;
            gap: 30px;
            color: #718096;
            margin-bottom: 20px;
        }

        .curriculum-preview {
            display: grid;
            gap: 15px;
        }

        .module-preview {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
        }

        .error {
            background: #fed7d7;
            color: #9b2c2c;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .success {
            background: #c6f6d5;
            color: #2f855a;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .file-upload {
            position: relative;
            display: inline-block;
        }

        .file-upload input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .icon {
            width: 20px;
            height: 20px;
            display: inline-block;
        }

        .sortable {
            min-height: 100px;
        }

        .sortable-ghost {
            opacity: 0.4;
        }

        @media (max-width: 768px) {
            .course-builder-container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .course-builder-tabs {
                flex-direction: column;
                gap: 5px;
            }

            .tab-button {
                min-width: auto;
            }

            .lesson-content {
                grid-template-columns: 1fr;
            }

            .preview-meta {
                flex-direction: column;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="course-builder-container">
        <!-- Header -->
        <div class="header">
            <h1>Course Builder</h1>
            <p>Create comprehensive wellness courses with structured modules and lessons</p>
        </div>

        <!-- Course Builder Tabs -->
        <div class="course-builder-tabs">
            <button class="tab-button active" onclick="showTab('basics')">Course Basics</button>
            <button class="tab-button" onclick="showTab('curriculum')">Curriculum</button>
            <button class="tab-button" onclick="showTab('content')">Content Upload</button>
            <button class="tab-button" onclick="showTab('settings')">Settings</button>
            <button class="tab-button" onclick="showTab('preview')">Preview</button>
        </div>

        <!-- Error/Success Messages -->
        <div id="errorMessage" class="error" style="display: none;"></div>
        <div id="successMessage" class="success" style="display: none;"></div>

        <!-- Course Basics Tab -->
        <div id="basics" class="tab-content active">
            <h2>Course Information</h2>
            <form id="courseBasicsForm">
                <div class="form-group">
                    <label class="form-label" for="courseTitle">Course Title</label>
                    <input type="text" id="courseTitle" class="form-input" required placeholder="Enter your course title">
                </div>

                <div class="form-group">
                    <label class="form-label" for="courseDescription">Course Description</label>
                    <textarea id="courseDescription" class="form-textarea" required placeholder="Describe what students will learn in this course"></textarea>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="courseCategory">Category</label>
                        <select id="courseCategory" class="form-select" required>
                            <option value="">Select category</option>
                            <option value="anxiety_management">Anxiety Management</option>
                            <option value="meditation">Meditation & Mindfulness</option>
                            <option value="fitness">Fitness & Movement</option>
                            <option value="nutrition">Nutrition & Wellness</option>
                            <option value="sleep">Sleep & Recovery</option>
                            <option value="stress_relief">Stress Relief</option>
                            <option value="self_care">Self Care</option>
                            <option value="relationships">Relationships</option>
                            <option value="personal_growth">Personal Growth</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="courseDifficulty">Difficulty Level</label>
                        <select id="courseDifficulty" class="form-select" required>
                            <option value="">Select difficulty</option>
                            <option value="beginner">Beginner</option>
                            <option value="intermediate">Intermediate</option>
                            <option value="advanced">Advanced</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label" for="courseDuration">Duration (weeks)</label>
                        <input type="number" id="courseDuration" class="form-input" min="1" max="52" required placeholder="4">
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="coursePrice">Course Price ($)</label>
                        <input type="number" id="coursePrice" class="form-input" step="0.01" min="0" required placeholder="99.00">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label" for="courseLearningObjectives">Learning Objectives</label>
                    <textarea id="courseLearningObjectives" class="form-textarea" placeholder="List the key skills and knowledge students will gain (one per line)"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="coursePrerequisites">Prerequisites</label>
                    <textarea id="coursePrerequisites" class="form-textarea" placeholder="List any requirements or prior knowledge needed (one per line)"></textarea>
                </div>

                <button type="button" class="btn btn-primary" onclick="saveBasics()">Save & Continue to Curriculum</button>
            </form>
        </div>

        <!-- Curriculum Tab -->
        <div id="curriculum" class="tab-content">
            <h2>Course Curriculum</h2>
            <p style="color: #718096; margin-bottom: 25px;">Build your course structure with modules and lessons. Drag and drop to reorder.</p>

            <div class="progress-bar">
                <div class="progress-fill" id="curriculumProgress" style="width: 0%"></div>
            </div>
            <div style="text-align: center; margin-bottom: 25px; color: #718096;">
                Course Progress: <span id="progressText">0%</span>
            </div>

            <div id="modulesContainer" class="sortable">
                <!-- Modules will be dynamically added here -->
            </div>

            <button type="button" class="btn btn-primary" onclick="addModule()">
                <span class="icon">+</span> Add New Module
            </button>
        </div>

        <!-- Content Upload Tab -->
        <div id="content" class="tab-content">
            <h2>Content Upload</h2>
            <p style="color: #718096; margin-bottom: 25px;">Upload videos, audio files, documents, and other course materials.</p>

            <div class="drag-drop-area" id="uploadArea">
                <div class="file-upload">
                    <input type="file" id="fileInput" multiple accept=".mp4,.mp3,.pdf,.doc,.docx,.ppt,.pptx">
                    <h3>Drop files here or click to upload</h3>
                    <p>Supported formats: Video (MP4), Audio (MP3), Documents (PDF, DOC, PPT)</p>
                </div>
            </div>

            <div id="uploadedFiles" style="margin-top: 25px;">
                <!-- Uploaded files will appear here -->
            </div>
        </div>

        <!-- Settings Tab -->
        <div id="settings" class="tab-content">
            <h2>Course Settings</h2>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="enableCertificate" checked>
                        Enable Certificate of Completion
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="enableDiscussion">
                        Enable Course Discussion Forum
                    </label>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="isPremium">
                        Premium Course (Higher Revenue Share)
                    </label>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        <input type="checkbox" id="autoEnroll">
                        Auto-enroll in Future Updates
                    </label>
                </div>
            </div>

            <div class="form-group">
                <label class="form-label" for="courseTags">Course Tags</label>
                <input type="text" id="courseTags" class="form-input" placeholder="wellness, meditation, anxiety, stress-relief (comma separated)">
            </div>
        </div>

        <!-- Preview Tab -->
        <div id="preview" class="tab-content">
            <h2>Course Preview</h2>
            <p style="color: #718096; margin-bottom: 25px;">Review your course before publishing.</p>

            <div class="course-preview">
                <div class="preview-header">
                    <div class="preview-title" id="previewTitle">Course Title</div>
                    <div class="preview-meta">
                        <span id="previewDuration">0 weeks</span>
                        <span id="previewModules">0 modules</span>
                        <span id="previewLessons">0 lessons</span>
                        <span id="previewPrice">$0.00</span>
                    </div>
                </div>

                <div id="previewDescription" style="margin-bottom: 25px; color: #718096;"></div>

                <div class="curriculum-preview" id="previewCurriculum">
                    <!-- Course structure preview will appear here -->
                </div>

                <div style="text-align: center; margin-top: 30px;">
                    <button type="button" class="btn btn-success" onclick="publishCourse()">
                        <span class="icon">üöÄ</span> Publish Course
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="saveDraft()">
                        <span class="icon">üíæ</span> Save as Draft
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Course data structure
        let courseData = {
            title: '',
            description: '',
            category: '',
            difficulty: '',
            duration: 0,
            price: 0,
            learningObjectives: [],
            prerequisites: [],
            modules: [],
            settings: {
                certificate: true,
                discussion: false,
                premium: false,
                autoEnroll: true,
                tags: []
            }
        };

        // Module counter for unique IDs
        let moduleCounter = 0;
        let lessonCounter = 0;

        // Tab management
        function showTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            // Update preview when preview tab is shown
            if (tabName === 'preview') {
                updatePreview();
            }
        }

        // Save course basics
        function saveBasics() {
            const title = document.getElementById('courseTitle').value;
            const description = document.getElementById('courseDescription').value;
            const category = document.getElementById('courseCategory').value;
            const difficulty = document.getElementById('courseDifficulty').value;
            const duration = parseInt(document.getElementById('courseDuration').value);
            const price = parseFloat(document.getElementById('coursePrice').value);
            
            if (!title || !description || !category || !difficulty || !duration || !price) {
                showError('Please fill in all required fields');
                return;
            }

            courseData.title = title;
            courseData.description = description;
            courseData.category = category;
            courseData.difficulty = difficulty;
            courseData.duration = duration;
            courseData.price = price;
            
            // Parse learning objectives and prerequisites
            const objectives = document.getElementById('courseLearningObjectives').value;
            const prerequisites = document.getElementById('coursePrerequisites').value;
            
            courseData.learningObjectives = objectives ? objectives.split('\n').filter(obj => obj.trim()) : [];
            courseData.prerequisites = prerequisites ? prerequisites.split('\n').filter(req => req.trim()) : [];

            showSuccess('Course basics saved successfully!');
            
            // Switch to curriculum tab
            showTab('curriculum');
            document.querySelector('[onclick="showTab(\'curriculum\')"]').classList.add('active');
        }

        // Add new module
        function addModule() {
            moduleCounter++;
            const moduleId = `module_${moduleCounter}`;
            
            const module = {
                id: moduleId,
                title: `Module ${moduleCounter}`,
                description: '',
                lessons: []
            };
            
            courseData.modules.push(module);
            renderModules();
            updateProgress();
        }

        // Render all modules
        function renderModules() {
            const container = document.getElementById('modulesContainer');
            container.innerHTML = '';
            
            courseData.modules.forEach((module, moduleIndex) => {
                const moduleHtml = `
                    <div class="module-builder" data-module-id="${module.id}">
                        <div class="module-header">
                            <input type="text" class="form-input" value="${module.title}" 
                                   onchange="updateModuleTitle(${moduleIndex}, this.value)" 
                                   style="flex: 1; margin-right: 15px;">
                            <button class="btn btn-danger" onclick="removeModule(${moduleIndex})">
                                <span class="icon">üóëÔ∏è</span> Remove
                            </button>
                        </div>
                        
                        <div class="form-group">
                            <textarea class="form-textarea" placeholder="Module description" 
                                      onchange="updateModuleDescription(${moduleIndex}, this.value)">${module.description}</textarea>
                        </div>
                        
                        <div id="lessons_${module.id}" class="sortable">
                            ${renderLessons(module.lessons, moduleIndex)}
                        </div>
                        
                        <button type="button" class="btn btn-secondary" onclick="addLesson(${moduleIndex})">
                            <span class="icon">+</span> Add Lesson
                        </button>
                    </div>
                `;
                container.innerHTML += moduleHtml;
            });
        }

        // Render lessons for a module
        function renderLessons(lessons, moduleIndex) {
            return lessons.map((lesson, lessonIndex) => `
                <div class="lesson-item" data-lesson-id="${lesson.id}">
                    <div class="lesson-header">
                        <input type="text" class="form-input" value="${lesson.title}" 
                               onchange="updateLessonTitle(${moduleIndex}, ${lessonIndex}, this.value)"
                               style="flex: 1; margin-right: 15px;">
                        <div class="lesson-controls">
                            <select class="form-select" onchange="updateLessonType(${moduleIndex}, ${lessonIndex}, this.value)">
                                <option value="video" ${lesson.type === 'video' ? 'selected' : ''}>Video</option>
                                <option value="audio" ${lesson.type === 'audio' ? 'selected' : ''}>Audio</option>
                                <option value="text" ${lesson.type === 'text' ? 'selected' : ''}>Text</option>
                                <option value="quiz" ${lesson.type === 'quiz' ? 'selected' : ''}>Quiz</option>
                            </select>
                            <button class="btn btn-danger" onclick="removeLesson(${moduleIndex}, ${lessonIndex})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="lesson-content">
                        <textarea class="form-textarea" placeholder="Lesson content description" 
                                  onchange="updateLessonContent(${moduleIndex}, ${lessonIndex}, this.value)">${lesson.content}</textarea>
                        <div>
                            <label class="form-label">Duration (minutes)</label>
                            <input type="number" class="form-input" value="${lesson.duration}" 
                                   onchange="updateLessonDuration(${moduleIndex}, ${lessonIndex}, this.value)">
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Add lesson to module
        function addLesson(moduleIndex) {
            lessonCounter++;
            const lesson = {
                id: `lesson_${lessonCounter}`,
                title: `Lesson ${courseData.modules[moduleIndex].lessons.length + 1}`,
                type: 'video',
                content: '',
                duration: 10
            };
            
            courseData.modules[moduleIndex].lessons.push(lesson);
            renderModules();
            updateProgress();
        }

        // Update functions
        function updateModuleTitle(moduleIndex, title) {
            courseData.modules[moduleIndex].title = title;
        }

        function updateModuleDescription(moduleIndex, description) {
            courseData.modules[moduleIndex].description = description;
        }

        function updateLessonTitle(moduleIndex, lessonIndex, title) {
            courseData.modules[moduleIndex].lessons[lessonIndex].title = title;
        }

        function updateLessonType(moduleIndex, lessonIndex, type) {
            courseData.modules[moduleIndex].lessons[lessonIndex].type = type;
        }

        function updateLessonContent(moduleIndex, lessonIndex, content) {
            courseData.modules[moduleIndex].lessons[lessonIndex].content = content;
        }

        function updateLessonDuration(moduleIndex, lessonIndex, duration) {
            courseData.modules[moduleIndex].lessons[lessonIndex].duration = parseInt(duration);
            updateProgress();
        }

        // Remove functions
        function removeModule(moduleIndex) {
            if (confirm('Are you sure you want to remove this module?')) {
                courseData.modules.splice(moduleIndex, 1);
                renderModules();
                updateProgress();
            }
        }

        function removeLesson(moduleIndex, lessonIndex) {
            if (confirm('Are you sure you want to remove this lesson?')) {
                courseData.modules[moduleIndex].lessons.splice(lessonIndex, 1);
                renderModules();
                updateProgress();
            }
        }

        // Update progress
        function updateProgress() {
            const totalModules = courseData.modules.length;
            const totalLessons = courseData.modules.reduce((sum, module) => sum + module.lessons.length, 0);
            const totalDuration = courseData.modules.reduce((sum, module) => 
                sum + module.lessons.reduce((lessonSum, lesson) => lessonSum + (lesson.duration || 0), 0), 0);
            
            const progress = totalModules > 0 ? Math.min(100, (totalLessons * 20)) : 0;
            
            document.getElementById('curriculumProgress').style.width = progress + '%';
            document.getElementById('progressText').textContent = progress + '%';
        }

        // Update preview
        function updatePreview() {
            document.getElementById('previewTitle').textContent = courseData.title || 'Course Title';
            document.getElementById('previewDescription').textContent = courseData.description || 'Course description';
            document.getElementById('previewDuration').textContent = (courseData.duration || 0) + ' weeks';
            document.getElementById('previewModules').textContent = courseData.modules.length + ' modules';
            
            const totalLessons = courseData.modules.reduce((sum, module) => sum + module.lessons.length, 0);
            document.getElementById('previewLessons').textContent = totalLessons + ' lessons';
            document.getElementById('previewPrice').textContent = '$' + (courseData.price || 0).toFixed(2);
            
            // Render curriculum preview
            const curriculumPreview = document.getElementById('previewCurriculum');
            curriculumPreview.innerHTML = courseData.modules.map((module, index) => `
                <div class="module-preview">
                    <h3>${module.title}</h3>
                    <p style="color: #718096;">${module.description}</p>
                    <ul style="margin-top: 15px;">
                        ${module.lessons.map(lesson => `
                            <li style="margin-bottom: 8px;">
                                <strong>${lesson.title}</strong> 
                                <span style="color: #718096;">(${lesson.type}, ${lesson.duration} min)</span>
                            </li>
                        `).join('')}
                    </ul>
                </div>
            `).join('');
        }

        // File upload handling
        document.getElementById('fileInput').addEventListener('change', handleFileUpload);
        document.getElementById('uploadArea').addEventListener('dragover', handleDragOver);
        document.getElementById('uploadArea').addEventListener('drop', handleFileDrop);

        function handleFileUpload(event) {
            const files = event.target.files;
            processFiles(files);
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('active');
        }

        function handleFileDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('active');
            const files = event.dataTransfer.files;
            processFiles(files);
        }

        function processFiles(files) {
            const uploadedFilesContainer = document.getElementById('uploadedFiles');
            
            Array.from(files).forEach(file => {
                const fileElement = document.createElement('div');
                fileElement.className = 'lesson-item';
                fileElement.innerHTML = `
                    <div class="lesson-header">
                        <span>${file.name}</span>
                        <span style="color: #718096;">${(file.size / 1024 / 1024).toFixed(2)} MB</span>
                    </div>
                `;
                uploadedFilesContainer.appendChild(fileElement);
            });
        }

        // Course publishing
        async function publishCourse() {
            if (!validateCourse()) {
                return;
            }

            try {
                // Get settings
                courseData.settings.certificate = document.getElementById('enableCertificate').checked;
                courseData.settings.discussion = document.getElementById('enableDiscussion').checked;
                courseData.settings.premium = document.getElementById('isPremium').checked;
                courseData.settings.autoEnroll = document.getElementById('autoEnroll').checked;
                
                const tags = document.getElementById('courseTags').value;
                courseData.settings.tags = tags ? tags.split(',').map(tag => tag.trim()) : [];

                const response = await fetch('/api/creator/courses', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        ...courseData,
                        status: 'published'
                    })
                });

                const result = await response.json();

                if (result.success) {
                    showSuccess('Course published successfully! Redirecting to creator dashboard...');
                    setTimeout(() => {
                        window.location.href = '/creator-dashboard';
                    }, 2000);
                } else {
                    showError(result.error || 'Failed to publish course');
                }
            } catch (error) {
                console.error('Error publishing course:', error);
                showError('Failed to publish course');
            }
        }

        function saveDraft() {
            // Similar to publishCourse but with draft status
            showSuccess('Course saved as draft');
        }

        function validateCourse() {
            if (!courseData.title) {
                showError('Please add a course title');
                showTab('basics');
                return false;
            }
            
            if (courseData.modules.length === 0) {
                showError('Please add at least one module');
                showTab('curriculum');
                return false;
            }
            
            const hasLessons = courseData.modules.some(module => module.lessons.length > 0);
            if (!hasLessons) {
                showError('Please add at least one lesson');
                showTab('curriculum');
                return false;
            }
            
            return true;
        }

        // Utility functions
        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
            document.getElementById('successMessage').style.display = 'none';
            
            setTimeout(() => {
                errorElement.style.display = 'none';
            }, 5000);
        }

        function showSuccess(message) {
            const successElement = document.getElementById('successMessage');
            successElement.textContent = message;
            successElement.style.display = 'block';
            document.getElementById('errorMessage').style.display = 'none';
            
            setTimeout(() => {
                successElement.style.display = 'none';
            }, 5000);
        }

        // Initialize the course builder
        document.addEventListener('DOMContentLoaded', function() {
            // Add initial module if none exist
            if (courseData.modules.length === 0) {
                addModule();
            }
        });
    </script>
</body>
</html>