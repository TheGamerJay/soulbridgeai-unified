<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Export & Backup - SoulBridge AI</title>
    
    <!-- Modular CSS Files -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
    
    <style>
        .export-container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .export-header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .export-title {
            font-size: 2.5rem;
            font-weight: bold;
            color: #22d3ee;
            margin-bottom: 1rem;
        }
        
        .export-subtitle {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-bottom: 2rem;
        }
        
        .export-section {
            background: rgba(0,0,0,0.8);
            border: 2px solid #22d3ee;
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }
        
        .export-section:hover {
            background: rgba(0,0,0,0.9);
            box-shadow: 0 8px 25px rgba(34, 211, 238, 0.3);
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: bold;
            color: #22d3ee;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .section-description {
            color: #94a3b8;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }
        
        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        
        .export-option {
            background: rgba(34, 211, 238, 0.1);
            border: 1px solid #22d3ee;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .export-option:hover {
            background: rgba(34, 211, 238, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(34, 211, 238, 0.3);
        }
        
        .export-option.selected {
            background: rgba(34, 211, 238, 0.3);
            border-color: #0891b2;
        }
        
        .option-icon {
            font-size: 2rem;
            color: #22d3ee;
            margin-bottom: 0.5rem;
        }
        
        .option-title {
            font-weight: bold;
            color: #fff;
            margin-bottom: 0.25rem;
        }
        
        .option-description {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .export-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .control-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .control-label {
            font-size: 0.9rem;
            color: #94a3b8;
            font-weight: bold;
        }
        
        .control-input {
            padding: 0.5rem;
            border: 1px solid #22d3ee;
            border-radius: 6px;
            background: rgba(0,0,0,0.8);
            color: #fff;
            font-size: 0.9rem;
        }
        
        .control-input:focus {
            outline: none;
            border-color: #0891b2;
            box-shadow: 0 0 0 3px rgba(34, 211, 238, 0.2);
        }
        
        .export-actions {
            display: flex;
            gap: 1rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .action-btn {
            padding: 0.75rem 2rem;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #22d3ee, #0891b2);
            color: #000;
        }
        
        .btn-primary:hover {
            background: linear-gradient(135deg, #0891b2, #0e7490);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(34, 211, 238, 0.4);
        }
        
        .btn-secondary {
            background: rgba(75, 85, 99, 0.8);
            color: #fff;
            border: 1px solid #4b5563;
        }
        
        .btn-secondary:hover {
            background: rgba(75, 85, 99, 1);
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: #fff;
        }
        
        .btn-danger:hover {
            background: linear-gradient(135deg, #b91c1c, #991b1b);
            transform: translateY(-2px);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            color: #fff;
        }
        
        .btn-success:hover {
            background: linear-gradient(135deg, #16a34a, #15803d);
            transform: translateY(-2px);
        }
        
        .progress-container {
            display: none;
            margin-top: 1rem;
        }
        
        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(34, 211, 238, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22d3ee, #0891b2);
            border-radius: 4px;
            transition: width 0.3s ease;
            width: 0%;
        }
        
        .progress-text {
            text-align: center;
            color: #94a3b8;
            font-size: 0.9rem;
            margin-top: 0.5rem;
        }
        
        .backup-status {
            display: none;
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1rem;
            font-weight: bold;
            text-align: center;
        }
        
        .status-success {
            background: rgba(34, 197, 94, 0.2);
            border: 1px solid #22c55e;
            color: #22c55e;
        }
        
        .status-error {
            background: rgba(220, 38, 38, 0.2);
            border: 1px solid #dc2626;
            color: #dc2626;
        }
        
        .status-warning {
            background: rgba(249, 115, 22, 0.2);
            border: 1px solid #f97316;
            color: #f97316;
        }
        
        .file-drop-zone {
            border: 2px dashed #22d3ee;
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            background: rgba(34, 211, 238, 0.05);
            margin-bottom: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .file-drop-zone:hover {
            background: rgba(34, 211, 238, 0.1);
            border-color: #0891b2;
        }
        
        .file-drop-zone.dragover {
            background: rgba(34, 211, 238, 0.2);
            border-color: #0891b2;
            transform: scale(1.02);
        }
        
        .drop-icon {
            font-size: 3rem;
            color: #22d3ee;
            margin-bottom: 1rem;
        }
        
        .drop-text {
            color: #94a3b8;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
        }
        
        .drop-subtext {
            color: #6b7280;
            font-size: 0.9rem;
        }
        
        .file-input {
            display: none;
        }
        
        .restore-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .restore-option {
            background: rgba(75, 85, 99, 0.3);
            border: 1px solid #4b5563;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .restore-option:hover {
            background: rgba(75, 85, 99, 0.5);
            border-color: #6b7280;
        }
        
        .restore-option.selected {
            background: rgba(34, 211, 238, 0.3);
            border-color: #22d3ee;
        }
        
        .navigation-buttons {
            display: flex;
            justify-content: center;
            gap: 1rem;
            margin-top: 2rem;
        }
        
        /* Day mode adjustments */
        body.day-mode .export-section {
            background: rgba(248, 249, 250, 0.9);
            border-color: #000;
        }
        
        body.day-mode .export-section:hover {
            background: rgba(248, 249, 250, 1);
        }
        
        body.day-mode .export-title {
            color: #000;
        }
        
        body.day-mode .section-title {
            color: #000;
        }
        
        body.day-mode .option-title {
            color: #000;
        }
        
        body.day-mode .control-input {
            background: rgba(255, 255, 255, 0.9);
            border-color: #000;
            color: #000;
        }
        
        body.day-mode .file-drop-zone {
            border-color: #000;
            background: rgba(0, 0, 0, 0.05);
        }
        
        body.day-mode .file-drop-zone:hover {
            background: rgba(0, 0, 0, 0.1);
            border-color: #374151;
        }
        
        /* Mobile responsive */
        @media (max-width: 768px) {
            .export-container {
                padding: 1rem;
            }
            
            .export-title {
                font-size: 2rem;
            }
            
            .export-options {
                grid-template-columns: 1fr;
            }
            
            .export-controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .export-actions {
                flex-direction: column;
            }
            
            .action-btn {
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="export-container">
        <!-- Header -->
        <div class="export-header">
            <h1 class="export-title">üì• Export & Backup</h1>
            <p class="export-subtitle">Save and manage your SoulBridge AI conversations and data</p>
        </div>

        <!-- Export Conversations Section -->
        <div class="export-section" id="exportSection">
            <h2 class="section-title">
                üìÑ Export Conversations
            </h2>
            <p class="section-description">
                Export your conversations in various formats for sharing, archiving, or analysis. Choose from PDF, TXT, or JSON formats.
            </p>
            
            <div class="export-options" id="formatOptions">
                <div class="export-option" data-format="pdf">
                    <div class="option-icon">üìÑ</div>
                    <div class="option-title">PDF Document</div>
                    <div class="option-description">Professional formatted document</div>
                </div>
                <div class="export-option" data-format="txt">
                    <div class="option-icon">üìù</div>
                    <div class="option-title">Text File</div>
                    <div class="option-description">Simple plain text format</div>
                </div>
                <div class="export-option selected" data-format="json">
                    <div class="option-icon">üíæ</div>
                    <div class="option-title">JSON Data</div>
                    <div class="option-description">Structured data format</div>
                </div>
            </div>
            
            <div class="export-controls">
                <div class="control-group">
                    <label class="control-label">Export Scope</label>
                    <select class="control-input" id="exportScope">
                        <option value="all">All Conversations</option>
                        <option value="favorites">Favorite Conversations</option>
                        <option value="recent">Recent (Last 30 days)</option>
                        <option value="character">By Character</option>
                        <option value="mood">By Mood</option>
                        <option value="custom">Custom Date Range</option>
                    </select>
                </div>
                
                <div class="control-group" id="characterFilter" style="display: none;">
                    <label class="control-label">Character</label>
                    <select class="control-input" id="characterSelect">
                        <option value="">All Characters</option>
                        <option value="Blayzo">Blayzo</option>
                        <option value="Blayzica">Blayzica</option>
                    </select>
                </div>
                
                <div class="control-group" id="moodFilter" style="display: none;">
                    <label class="control-label">Mood</label>
                    <select class="control-input" id="moodSelect">
                        <option value="">All Moods</option>
                        <option value="happy">üòä Happy</option>
                        <option value="sad">üò¢ Sad</option>
                        <option value="anxious">üò∞ Anxious</option>
                        <option value="angry">üò† Angry</option>
                        <option value="excited">ü§© Excited</option>
                        <option value="calm">üòå Calm</option>
                        <option value="confused">üòï Confused</option>
                        <option value="grateful">üôè Grateful</option>
                        <option value="lonely">üòî Lonely</option>
                        <option value="hopeful">üåü Hopeful</option>
                        <option value="stressed">üò§ Stressed</option>
                        <option value="content">üòä Content</option>
                    </select>
                </div>
                
                <div class="control-group" id="dateRange" style="display: none;">
                    <label class="control-label">Date Range</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <input type="date" class="control-input" id="startDate">
                        <span style="color: #94a3b8; padding: 0.5rem;">to</span>
                        <input type="date" class="control-input" id="endDate">
                    </div>
                </div>
            </div>
            
            <div class="export-actions">
                <button class="action-btn btn-primary" onclick="exportConversations()">
                    <span>üì•</span>
                    Export Conversations
                </button>
                <button class="action-btn btn-secondary" onclick="exportMoodReport()">
                    <span>üìä</span>
                    Export Mood Report
                </button>
            </div>
            
            <div class="progress-container" id="exportProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="exportProgressFill"></div>
                </div>
                <div class="progress-text" id="exportProgressText">Preparing export...</div>
            </div>
            
            <div class="backup-status" id="exportStatus"></div>
        </div>

        <!-- Backup & Restore Section -->
        <div class="export-section" id="backupSection">
            <h2 class="section-title">
                üíæ Complete Data Backup
            </h2>
            <p class="section-description">
                Create a comprehensive backup of all your data including conversations, tags, mood entries, and preferences.
            </p>
            
            <div class="export-actions">
                <button class="action-btn btn-success" onclick="createBackup()">
                    <span>üíæ</span>
                    Create Full Backup
                </button>
                <button class="action-btn btn-secondary" onclick="scheduleBackup()">
                    <span>‚è∞</span>
                    Schedule Auto-Backup
                </button>
            </div>
            
            <div class="progress-container" id="backupProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="backupProgressFill"></div>
                </div>
                <div class="progress-text" id="backupProgressText">Creating backup...</div>
            </div>
            
            <div class="backup-status" id="backupStatus"></div>
        </div>

        <!-- Restore Section -->
        <div class="export-section" id="restoreSection">
            <h2 class="section-title">
                üì§ Restore from Backup
            </h2>
            <p class="section-description">
                Restore your data from a previously created backup file. Choose merge or replace mode for data restoration.
            </p>
            
            <div class="file-drop-zone" id="fileDropZone" onclick="document.getElementById('backupFile').click()">
                <div class="drop-icon">üìÅ</div>
                <div class="drop-text">Click to select backup file</div>
                <div class="drop-subtext">or drag and drop your backup file here</div>
                <div class="drop-subtext">Supported: .json backup files</div>
            </div>
            
            <input type="file" id="backupFile" class="file-input" accept=".json" onchange="handleFileSelect(event)">
            
            <div class="restore-options" id="restoreOptions" style="display: none;">
                <div class="restore-option selected" data-mode="merge">
                    <div class="option-icon">üîÄ</div>
                    <div class="option-title">Merge Data</div>
                    <div class="option-description">Add backup data to existing</div>
                </div>
                <div class="restore-option" data-mode="replace">
                    <div class="option-icon">üîÑ</div>
                    <div class="option-title">Replace Data</div>
                    <div class="option-description">Replace all current data</div>
                </div>
            </div>
            
            <div class="export-actions" id="restoreActions" style="display: none;">
                <button class="action-btn btn-success" onclick="restoreBackup()" id="restoreBtn">
                    <span>üì§</span>
                    Restore Backup
                </button>
                <button class="action-btn btn-danger" onclick="cancelRestore()">
                    <span>‚ùå</span>
                    Cancel
                </button>
            </div>
            
            <div class="progress-container" id="restoreProgress">
                <div class="progress-bar">
                    <div class="progress-fill" id="restoreProgressFill"></div>
                </div>
                <div class="progress-text" id="restoreProgressText">Restoring data...</div>
            </div>
            
            <div class="backup-status" id="restoreStatus"></div>
        </div>

        <!-- Navigation -->
        <div class="navigation-buttons">
            <button class="action-btn btn-secondary" onclick="window.location.href='/mood/dashboard'">
                <span>üìä</span>
                Mood Dashboard
            </button>
            <button class="action-btn btn-secondary" onclick="window.location.href='/library'">
                <span>üìö</span>
                Conversation Library
            </button>
            <button class="action-btn btn-secondary" onclick="window.location.href='/character-chat'">
                <span>üí¨</span>
                Chat Interface
            </button>
        </div>
    </div>

    <script>
        let selectedFormat = 'json';
        let selectedFile = null;
        
        // Format selection
        document.querySelectorAll('.export-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.export-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
                selectedFormat = option.dataset.format;
            });
        });
        
        // Export scope handling
        document.getElementById('exportScope').addEventListener('change', (e) => {
            const scope = e.target.value;
            
            // Hide all filter options
            document.getElementById('characterFilter').style.display = 'none';
            document.getElementById('moodFilter').style.display = 'none';
            document.getElementById('dateRange').style.display = 'none';
            
            // Show relevant filter
            if (scope === 'character') {
                document.getElementById('characterFilter').style.display = 'block';
            } else if (scope === 'mood') {
                document.getElementById('moodFilter').style.display = 'block';
            } else if (scope === 'custom') {
                document.getElementById('dateRange').style.display = 'block';
            }
        });
        
        // File drag and drop
        const fileDropZone = document.getElementById('fileDropZone');
        const fileInput = document.getElementById('backupFile');
        
        fileDropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            fileDropZone.classList.add('dragover');
        });
        
        fileDropZone.addEventListener('dragleave', () => {
            fileDropZone.classList.remove('dragover');
        });
        
        fileDropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            fileDropZone.classList.remove('dragover');
            
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                handleFileSelect({ target: { files: files } });
            }
        });
        
        // Restore mode selection
        document.querySelectorAll('.restore-option').forEach(option => {
            option.addEventListener('click', () => {
                document.querySelectorAll('.restore-option').forEach(o => o.classList.remove('selected'));
                option.classList.add('selected');
            });
        });
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (!file.name.endsWith('.json')) {
                showStatus('restoreStatus', 'error', 'Please select a valid JSON backup file.');
                return;
            }
            
            selectedFile = file;
            
            // Update drop zone text
            const dropText = document.querySelector('.drop-text');
            dropText.textContent = `Selected: ${file.name}`;
            
            // Show restore options
            document.getElementById('restoreOptions').style.display = 'grid';
            document.getElementById('restoreActions').style.display = 'flex';
        }
        
        async function exportConversations() {
            const scope = document.getElementById('exportScope').value;
            const character = document.getElementById('characterSelect').value;
            const mood = document.getElementById('moodSelect').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            
            // Build query parameters
            const params = new URLSearchParams({
                format: selectedFormat
            });
            
            if (scope === 'favorites') params.append('favorites', 'true');
            if (scope === 'recent') params.append('days', '30');
            if (scope === 'character' && character) params.append('character', character);
            if (scope === 'mood' && mood) params.append('mood', mood);
            if (scope === 'custom' && startDate && endDate) {
                params.append('start_date', startDate);
                params.append('end_date', endDate);
            }
            
            try {
                showProgress('exportProgress', 'exportProgressFill', 'exportProgressText', 'Preparing export...');
                
                const response = await fetch(`/export/conversations?${params.toString()}`);
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Export failed');
                }
                
                // Update progress
                updateProgress('exportProgressFill', 'exportProgressText', 50, 'Generating file...');
                
                // Download file
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                // Get filename from response headers
                const disposition = response.headers.get('Content-Disposition');
                const filename = disposition ? disposition.split('filename=')[1].replace(/"/g, '') : `conversations.${selectedFormat}`;
                
                a.download = filename;
                a.click();
                
                window.URL.revokeObjectURL(url);
                
                updateProgress('exportProgressFill', 'exportProgressText', 100, 'Export completed!');
                
                setTimeout(() => {
                    hideProgress('exportProgress');
                    showStatus('exportStatus', 'success', '‚úÖ Conversations exported successfully!');
                }, 1000);
                
            } catch (error) {
                hideProgress('exportProgress');
                showStatus('exportStatus', 'error', `‚ùå Export failed: ${error.message}`);
            }
        }
        
        async function exportMoodReport() {
            const days = prompt('Enter number of days for mood report (default: 30):', '30');
            if (!days) return;
            
            try {
                showProgress('exportProgress', 'exportProgressFill', 'exportProgressText', 'Generating mood report...');
                
                const response = await fetch(`/export/mood-report?format=pdf&days=${days}`);
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Mood report export failed');
                }
                
                updateProgress('exportProgressFill', 'exportProgressText', 50, 'Creating PDF...');
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `mood_report_${days}days.pdf`;
                a.click();
                
                window.URL.revokeObjectURL(url);
                
                updateProgress('exportProgressFill', 'exportProgressText', 100, 'Report generated!');
                
                setTimeout(() => {
                    hideProgress('exportProgress');
                    showStatus('exportStatus', 'success', '‚úÖ Mood report exported successfully!');
                }, 1000);
                
            } catch (error) {
                hideProgress('exportProgress');
                showStatus('exportStatus', 'error', `‚ùå Mood report export failed: ${error.message}`);
            }
        }
        
        async function createBackup() {
            try {
                showProgress('backupProgress', 'backupProgressFill', 'backupProgressText', 'Creating backup...');
                
                const response = await fetch('/backup/create', { method: 'POST' });
                
                if (!response.ok) {
                    const error = await response.json();
                    throw new Error(error.error || 'Backup creation failed');
                }
                
                updateProgress('backupProgressFill', 'backupProgressText', 50, 'Packaging data...');
                
                const blob = await response.blob();
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                
                const disposition = response.headers.get('Content-Disposition');
                const filename = disposition ? disposition.split('filename=')[1].replace(/"/g, '') : 'soulbridge_backup.json';
                
                a.download = filename;
                a.click();
                
                window.URL.revokeObjectURL(url);
                
                updateProgress('backupProgressFill', 'backupProgressText', 100, 'Backup completed!');
                
                setTimeout(() => {
                    hideProgress('backupProgress');
                    showStatus('backupStatus', 'success', '‚úÖ Full backup created successfully!');
                }, 1000);
                
            } catch (error) {
                hideProgress('backupProgress');
                showStatus('backupStatus', 'error', `‚ùå Backup failed: ${error.message}`);
            }
        }
        
        async function restoreBackup() {
            if (!selectedFile) {
                showStatus('restoreStatus', 'error', 'Please select a backup file first.');
                return;
            }
            
            const selectedMode = document.querySelector('.restore-option.selected').dataset.mode;
            
            if (selectedMode === 'replace') {
                const confirmed = confirm('‚ö†Ô∏è WARNING: This will replace ALL your current data with the backup data. This action cannot be undone. Are you sure?');
                if (!confirmed) return;
            }
            
            try {
                showProgress('restoreProgress', 'restoreProgressFill', 'restoreProgressText', 'Reading backup file...');
                
                const formData = new FormData();
                formData.append('backup_file', selectedFile);
                formData.append('restore_mode', selectedMode);
                
                if (selectedMode === 'replace') {
                    formData.append('confirm_replace', 'true');
                }
                
                updateProgress('restoreProgressFill', 'restoreProgressText', 25, 'Uploading backup...');
                
                const response = await fetch('/backup/restore', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (!response.ok) {
                    throw new Error(result.error || 'Restore failed');
                }
                
                updateProgress('restoreProgressFill', 'restoreProgressText', 75, 'Restoring data...');
                
                setTimeout(() => {
                    updateProgress('restoreProgressFill', 'restoreProgressText', 100, 'Restore completed!');
                    
                    setTimeout(() => {
                        hideProgress('restoreProgress');
                        
                        const restored = result.restored;
                        const message = `‚úÖ Backup restored successfully!\n\n` +
                                       `Conversations: ${restored.conversations}\n` +
                                       `Tags: ${restored.tags}\n` +
                                       `Mood Entries: ${restored.mood_entries}`;
                        
                        showStatus('restoreStatus', 'success', message.replace(/\n/g, '<br>'));
                        
                        // Reset form
                        cancelRestore();
                    }, 1000);
                }, 1000);
                
            } catch (error) {
                hideProgress('restoreProgress');
                showStatus('restoreStatus', 'error', `‚ùå Restore failed: ${error.message}`);
            }
        }
        
        function cancelRestore() {
            selectedFile = null;
            document.getElementById('backupFile').value = '';
            document.querySelector('.drop-text').textContent = 'Click to select backup file';
            document.getElementById('restoreOptions').style.display = 'none';
            document.getElementById('restoreActions').style.display = 'none';
            hideStatus('restoreStatus');
        }
        
        function scheduleBackup() {
            alert('Auto-backup scheduling will be available in a future update. For now, please create manual backups regularly.');
        }
        
        // Utility functions
        function showProgress(containerId, fillId, textId, text) {
            document.getElementById(containerId).style.display = 'block';
            document.getElementById(fillId).style.width = '0%';
            document.getElementById(textId).textContent = text;
        }
        
        function updateProgress(fillId, textId, percentage, text) {
            document.getElementById(fillId).style.width = percentage + '%';
            document.getElementById(textId).textContent = text;
        }
        
        function hideProgress(containerId) {
            document.getElementById(containerId).style.display = 'none';
        }
        
        function showStatus(statusId, type, message) {
            const statusElement = document.getElementById(statusId);
            statusElement.className = `backup-status status-${type}`;
            statusElement.innerHTML = message;
            statusElement.style.display = 'block';
        }
        
        function hideStatus(statusId) {
            document.getElementById(statusId).style.display = 'none';
        }
        
        // Set default end date to today
        document.getElementById('endDate').value = new Date().toISOString().split('T')[0];
        
        // Theme handling
        function updateTheme() {
            // Theme switching is handled by the existing theme system
        }
        
        // Initialize theme
        updateTheme();
    </script>
</body>
</html>
