<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Emotional Meditations - SoulBridge AI</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: linear-gradient(135deg, #000000 0%, #0f172a 50%, #1e293b 100%);
      color: #e2e8f0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 900px;
      margin: auto;
      background: rgba(15, 23, 42, 0.8);
      border: 2px solid rgba(34, 211, 238, 0.2);
      border-radius: 20px;
      padding: 40px;
      backdrop-filter: blur(20px);
    }

    .header {
      text-align: center;
      margin-bottom: 40px;
    }

    .header h1 {
      color: #22d3ee;
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 0 0 20px rgba(34, 211, 238, 0.5);
    }

    .header p {
      color: #94a3b8;
      font-size: 1.1rem;
    }

    .meditation-categories {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }

    .category-card {
      background: rgba(34, 211, 238, 0.1);
      border: 2px solid rgba(34, 211, 238, 0.2);
      border-radius: 15px;
      padding: 25px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .category-card:hover {
      border-color: #22d3ee;
      transform: translateY(-5px);
      box-shadow: 0 10px 30px rgba(34, 211, 238, 0.3);
    }

    .category-icon {
      font-size: 3rem;
      margin-bottom: 15px;
    }

    .category-title {
      color: #22d3ee;
      font-size: 1.3rem;
      font-weight: 600;
      margin-bottom: 10px;
    }

    .category-description {
      color: #94a3b8;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    .meditation-player {
      background: rgba(15, 23, 42, 0.6);
      border: 2px solid rgba(34, 211, 238, 0.3);
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 30px;
      display: none;
    }

    .player-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .meditation-title {
      color: #22d3ee;
      font-size: 2rem;
      margin-bottom: 10px;
    }

    .meditation-subtitle {
      color: #94a3b8;
      font-size: 1.1rem;
    }

    .meditation-controls {
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 20px;
      margin: 30px 0;
    }

    .play-button {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      border: none;
      background: linear-gradient(135deg, #22d3ee, #0891b2);
      color: #000;
      font-size: 2rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .play-button:hover {
      transform: scale(1.1);
      box-shadow: 0 0 30px rgba(34, 211, 238, 0.6);
    }

    .time-display {
      color: #22d3ee;
      font-size: 1.2rem;
      font-weight: 600;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: rgba(34, 211, 238, 0.2);
      border-radius: 4px;
      margin: 20px 0;
      cursor: pointer;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #22d3ee, #0891b2);
      border-radius: 4px;
      width: 0%;
      transition: width 0.1s ease;
    }

    .meditation-content {
      background: rgba(34, 211, 238, 0.05);
      border: 1px solid rgba(34, 211, 238, 0.2);
      border-radius: 12px;
      padding: 25px;
      margin: 20px 0;
      text-align: center;
    }

    .meditation-text {
      color: #e2e8f0;
      font-size: 1.2rem;
      line-height: 1.8;
      margin-bottom: 20px;
    }

    .breathing-guide {
      display: none;
      text-align: center;
      margin: 30px 0;
    }

    .breathing-circle {
      width: 200px;
      height: 200px;
      border: 4px solid #22d3ee;
      border-radius: 50%;
      margin: 0 auto 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      animation: breathe 4s ease-in-out infinite;
    }

    @keyframes breathe {
      0%, 100% {
        transform: scale(1);
        border-color: #22d3ee;
      }
      50% {
        transform: scale(1.2);
        border-color: #0891b2;
      }
    }

    .breathing-instruction {
      color: #22d3ee;
      font-size: 1.5rem;
      font-weight: 600;
    }

    .meditation-list {
      display: none;
    }

    .meditation-item {
      background: rgba(15, 23, 42, 0.4);
      border: 1px solid rgba(34, 211, 238, 0.2);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .meditation-item:hover {
      border-color: #22d3ee;
      background: rgba(34, 211, 238, 0.1);
    }

    .item-title {
      color: #22d3ee;
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 8px;
    }

    .item-duration {
      color: #94a3b8;
      font-size: 0.9rem;
      margin-bottom: 5px;
    }

    .item-description {
      color: #e2e8f0;
      font-size: 0.95rem;
      line-height: 1.4;
    }

    .back-btn {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(34, 211, 238, 0.8);
      color: #000;
      padding: 10px 16px;
      border-radius: 20px;
      text-decoration: none;
      font-weight: bold;
      transition: all 0.3s ease;
    }

    .back-btn:hover {
      background: rgba(34, 211, 238, 1);
      transform: translateY(-2px);
    }

    .return-btn {
      background: rgba(34, 211, 238, 0.2);
      color: #22d3ee;
      border: 2px solid rgba(34, 211, 238, 0.3);
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .return-btn:hover {
      background: rgba(34, 211, 238, 0.3);
      transform: translateY(-2px);
    }

    .session-stats {
      background: rgba(34, 211, 238, 0.1);
      border: 1px solid rgba(34, 211, 238, 0.2);
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 30px;
      text-align: center;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 20px;
    }

    .stat-item {
      text-align: center;
    }

    .stat-number {
      color: #22d3ee;
      font-size: 1.8rem;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      color: #94a3b8;
      font-size: 0.9rem;
    }

    @media (max-width: 768px) {
      .meditation-categories {
        grid-template-columns: 1fr;
      }
      
      .meditation-controls {
        flex-direction: column;
        gap: 15px;
      }
    }
  </style>
</head>
<body>
  <a href="/chat" class="back-btn">‚Üê Back to Chat</a>

  <div class="container">
    <div class="header">
      <h1>üßò Emotional Meditations</h1>
      <p>Guided meditations for emotional healing and mindfulness</p>
    </div>

    <!-- Session Stats -->
    <div class="session-stats">
      <h3 style="color: #22d3ee; margin-bottom: 15px;">Your Meditation Journey</h3>
      <div class="stats-grid">
        <div class="stat-item">
          <div class="stat-number" id="totalSessions">0</div>
          <div class="stat-label">Sessions</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="totalMinutes">0</div>
          <div class="stat-label">Minutes</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="streakDays">0</div>
          <div class="stat-label">Day Streak</div>
        </div>
        <div class="stat-item">
          <div class="stat-number" id="favoriteType">-</div>
          <div class="stat-label">Favorite Type</div>
        </div>
      </div>
    </div>

    <!-- Categories -->
    <div class="meditation-categories" id="categoriesView">
      <div class="category-card" onclick="showMeditations('stress')">
        <div class="category-icon">üòå</div>
        <div class="category-title">Stress Relief</div>
        <div class="category-description">Release tension and find calm in moments of stress</div>
      </div>

      <div class="category-card" onclick="showMeditations('anxiety')">
        <div class="category-icon">üå±</div>
        <div class="category-title">Anxiety Support</div>
        <div class="category-description">Gentle guidance for managing anxious thoughts</div>
      </div>

      <div class="category-card" onclick="showMeditations('sleep')">
        <div class="category-icon">üåô</div>
        <div class="category-title">Sleep & Rest</div>
        <div class="category-description">Peaceful meditations to help you unwind and sleep</div>
      </div>

      <div class="category-card" onclick="showMeditations('healing')">
        <div class="category-icon">üíö</div>
        <div class="category-title">Emotional Healing</div>
        <div class="category-description">Compassionate practices for processing emotions</div>
      </div>

      <div class="category-card" onclick="showMeditations('confidence')">
        <div class="category-icon">‚ú®</div>
        <div class="category-title">Self-Confidence</div>
        <div class="category-description">Build inner strength and self-compassion</div>
      </div>

      <div class="category-card" onclick="showMeditations('breathing')">
        <div class="category-icon">ü´Å</div>
        <div class="category-title">Breathing Exercises</div>
        <div class="category-description">Focused breathing for immediate calm</div>
      </div>
    </div>

    <!-- Meditation List -->
    <div class="meditation-list" id="meditationList">
      <h3 style="color: #22d3ee; margin-bottom: 20px;" id="categoryTitle"></h3>
      <div id="meditationItems"></div>
      <button class="return-btn" onclick="returnToCategories()">‚Üê Back to Categories</button>
    </div>

    <!-- Meditation Player -->
    <div class="meditation-player" id="meditationPlayer">
      <div class="player-header">
        <div class="meditation-title" id="playerTitle"></div>
        <div class="meditation-subtitle" id="playerSubtitle"></div>
      </div>

      <div class="meditation-controls">
        <button class="play-button" id="playButton" onclick="togglePlayback()">‚ñ∂Ô∏è</button>
        <div class="time-display">
          <span id="currentTime">0:00</span> / <span id="totalTime">0:00</span>
        </div>
      </div>

      <div class="progress-bar" onclick="seekTo(event)">
        <div class="progress-fill" id="progressFill"></div>
      </div>

      <div class="meditation-content">
        <div class="meditation-text" id="meditationText"></div>
      </div>

      <div class="breathing-guide" id="breathingGuide">
        <div class="breathing-circle">
          <div class="breathing-instruction" id="breathingInstruction">Breathe</div>
        </div>
      </div>

      <button class="return-btn" onclick="stopMeditation()">‚Üê End Session</button>
    </div>
  </div>

  <script>
    let currentMeditation = null;
    let isPlaying = false;
    let currentTime = 0;
    let totalTime = 0;
    let meditationTimer = null;
    let breathingPhase = 'inhale';

    const meditations = {
      stress: [
        {
          id: 'stress-1',
          title: 'Quick Stress Release',
          duration: 300, // 5 minutes
          description: 'A rapid reset for overwhelming moments',
          text: 'Find a comfortable position and close your eyes. Take a deep breath in through your nose for 4 counts... hold for 4... and release through your mouth for 8. Feel the tension leaving your body with each exhale.'
        },
        {
          id: 'stress-2',
          title: 'Progressive Muscle Relaxation',
          duration: 900, // 15 minutes
          description: 'Release physical tension throughout your body',
          text: 'We\'ll start by tensing and releasing each muscle group. Begin with your toes, curl them tightly for 5 seconds... now release and feel the relaxation flow through your feet.'
        }
      ],
      anxiety: [
        {
          id: 'anxiety-1',
          title: 'Grounding Meditation',
          duration: 600, // 10 minutes
          description: 'Anchor yourself in the present moment',
          text: 'Notice 5 things you can see around you. Now 4 things you can touch. 3 things you can hear. 2 things you can smell. 1 thing you can taste. You are here, you are safe, you are present.'
        },
        {
          id: 'anxiety-2',
          title: 'Loving Kindness for Anxiety',
          duration: 720, // 12 minutes
          description: 'Gentle self-compassion for anxious moments',
          text: 'Place your hand on your heart. Feel its steady rhythm. Say to yourself: "May I be safe. May I be peaceful. May I be free from anxiety. May I give myself the compassion I need."'
        }
      ],
      sleep: [
        {
          id: 'sleep-1',
          title: 'Peaceful Night Journey',
          duration: 1200, // 20 minutes
          description: 'Drift into restful sleep naturally',
          text: 'Imagine yourself in a peaceful meadow under starlight. Each star above represents a worry floating away. Feel yourself sinking into the soft grass, completely supported and safe.'
        }
      ],
      healing: [
        {
          id: 'healing-1',
          title: 'Inner Child Healing',
          duration: 900, // 15 minutes
          description: 'Connect with and comfort your inner child',
          text: 'Imagine meeting yourself as a child. What does this young version of you need to hear? Offer them the love, understanding, and protection they deserve.'
        }
      ],
      confidence: [
        {
          id: 'confidence-1',
          title: 'Inner Strength Meditation',
          duration: 480, // 8 minutes
          description: 'Connect with your inherent power and worth',
          text: 'Visualize a warm golden light in your chest. This is your inner strength - it has always been there. Feel it growing brighter with each breath, filling you with confidence and self-love.'
        }
      ],
      breathing: [
        {
          id: 'breathing-1',
          title: '4-7-8 Breathing',
          duration: 240, // 4 minutes
          description: 'Calming breath work for immediate relief',
          text: 'Inhale for 4 counts, hold for 7, exhale for 8. This powerful technique activates your body\'s relaxation response.',
          isBreathing: true
        }
      ]
    };

    document.addEventListener('DOMContentLoaded', function() {
      loadMeditationStats();
    });

    function showMeditations(category) {
      const categoriesView = document.getElementById('categoriesView');
      const meditationList = document.getElementById('meditationList');
      const categoryTitle = document.getElementById('categoryTitle');
      const meditationItems = document.getElementById('meditationItems');

      categoriesView.style.display = 'none';
      meditationList.style.display = 'block';

      const categoryNames = {
        stress: 'Stress Relief Meditations',
        anxiety: 'Anxiety Support Meditations',
        sleep: 'Sleep & Rest Meditations',
        healing: 'Emotional Healing Meditations',
        confidence: 'Self-Confidence Meditations',
        breathing: 'Breathing Exercises'
      };

      categoryTitle.textContent = categoryNames[category];
      meditationItems.innerHTML = '';

      meditations[category].forEach(meditation => {
        const item = document.createElement('div');
        item.className = 'meditation-item';
        item.onclick = () => startMeditation(meditation);

        const minutes = Math.floor(meditation.duration / 60);
        const seconds = meditation.duration % 60;
        const durationText = `${minutes}:${seconds.toString().padStart(2, '0')}`;

        item.innerHTML = `
          <div class="item-title">${meditation.title}</div>
          <div class="item-duration">Duration: ${durationText}</div>
          <div class="item-description">${meditation.description}</div>
        `;

        meditationItems.appendChild(item);
      });
    }

    function returnToCategories() {
      document.getElementById('categoriesView').style.display = 'grid';
      document.getElementById('meditationList').style.display = 'none';
    }

    function startMeditation(meditation) {
      currentMeditation = meditation;
      currentTime = 0;
      totalTime = meditation.duration;

      const meditationList = document.getElementById('meditationList');
      const meditationPlayer = document.getElementById('meditationPlayer');
      const playerTitle = document.getElementById('playerTitle');
      const playerSubtitle = document.getElementById('playerSubtitle');
      const meditationText = document.getElementById('meditationText');
      const breathingGuide = document.getElementById('breathingGuide');
      const totalTimeDisplay = document.getElementById('totalTime');

      meditationList.style.display = 'none';
      meditationPlayer.style.display = 'block';

      playerTitle.textContent = meditation.title;
      playerSubtitle.textContent = meditation.description;
      meditationText.textContent = meditation.text;

      const minutes = Math.floor(totalTime / 60);
      const seconds = totalTime % 60;
      totalTimeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

      if (meditation.isBreathing) {
        breathingGuide.style.display = 'block';
        startBreathingAnimation();
      } else {
        breathingGuide.style.display = 'none';
      }

      updateProgressDisplay();
    }

    function togglePlayback() {
      const playButton = document.getElementById('playButton');

      if (isPlaying) {
        // Pause
        isPlaying = false;
        playButton.textContent = '‚ñ∂Ô∏è';
        if (meditationTimer) {
          clearInterval(meditationTimer);
        }
      } else {
        // Play
        isPlaying = true;
        playButton.textContent = '‚è∏Ô∏è';
        
        meditationTimer = setInterval(() => {
          currentTime++;
          updateProgressDisplay();

          if (currentTime >= totalTime) {
            completeMeditation();
          }
        }, 1000);
      }
    }

    function updateProgressDisplay() {
      const currentTimeDisplay = document.getElementById('currentTime');
      const progressFill = document.getElementById('progressFill');

      const minutes = Math.floor(currentTime / 60);
      const seconds = currentTime % 60;
      currentTimeDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;

      const progress = (currentTime / totalTime) * 100;
      progressFill.style.width = `${progress}%`;
    }

    function seekTo(event) {
      const progressBar = event.currentTarget;
      const rect = progressBar.getBoundingClientRect();
      const clickX = event.clientX - rect.left;
      const progress = clickX / rect.width;
      
      currentTime = Math.floor(progress * totalTime);
      updateProgressDisplay();
    }

    function startBreathingAnimation() {
      if (!currentMeditation?.isBreathing) return;

      const instruction = document.getElementById('breathingInstruction');
      
      function breatheCycle() {
        // Inhale (4 seconds)
        instruction.textContent = 'Inhale';
        setTimeout(() => {
          // Hold (7 seconds)
          instruction.textContent = 'Hold';
          setTimeout(() => {
            // Exhale (8 seconds)
            instruction.textContent = 'Exhale';
            setTimeout(() => {
              if (isPlaying && currentMeditation?.isBreathing) {
                breatheCycle();
              }
            }, 8000);
          }, 7000);
        }, 4000);
      }

      if (isPlaying) {
        breatheCycle();
      }
    }

    async function completeMeditation() {
      isPlaying = false;
      document.getElementById('playButton').textContent = '‚ñ∂Ô∏è';
      
      if (meditationTimer) {
        clearInterval(meditationTimer);
      }

      // Save session stats
      await saveMeditationSession();

  // Meditation completed (alert removed for production)
  stopMeditation();
    }

    function stopMeditation() {
      if (meditationTimer) {
        clearInterval(meditationTimer);
      }
      
      isPlaying = false;
      currentTime = 0;
      totalTime = 0;
      currentMeditation = null;

      document.getElementById('meditationPlayer').style.display = 'none';
      document.getElementById('categoriesView').style.display = 'grid';
      
      loadMeditationStats();
    }

    async function saveMeditationSession() {
      if (!currentMeditation) return;

      try {
        const sessionData = {
          meditationId: currentMeditation.id,
          title: currentMeditation.title,
          duration: Math.min(currentTime, totalTime),
          completed: currentTime >= totalTime,
          timestamp: new Date().toISOString()
        };

        const response = await fetch('/api/emotional-meditations/save-session', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          credentials: 'include',
          body: JSON.stringify(sessionData)
        });

        const result = await response.json();
        
        if (!result.success) {
          // Failed to save meditation session (console removed for production)
        }

      } catch (error) {
  // Error saving meditation session (console removed for production)
      }
    }

    async function loadMeditationStats() {
      try {
        const response = await fetch('/api/emotional-meditations/stats', {
          credentials: 'include'
        });

        const result = await response.json();

        if (result.success && result.stats) {
          document.getElementById('totalSessions').textContent = result.stats.totalSessions || 0;
          document.getElementById('totalMinutes').textContent = result.stats.totalMinutes || 0;
          document.getElementById('streakDays').textContent = result.stats.streakDays || 0;
          document.getElementById('favoriteType').textContent = result.stats.favoriteType || '-';
        }

      } catch (error) {
  // Error loading meditation stats (console removed for production)
      }
    }
  </script>
</body>
</html>