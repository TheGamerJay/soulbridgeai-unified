<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>Welcome to SoulBridge AI</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/favicon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/favicon-512x512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <meta name="theme-color" content="#00ffff">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="SoulBridge AI - Your Journey to Emotional Wellness">
    <meta property="og:description" content="Connect with AI companions designed for healing, growth, and spiritual guidance. Start your transformative journey today.">
    <meta property="og:image" content="{{ url_for('static', filename='logos/IntroLogo.png', _external=True) }}">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:type" content="website">
    <meta property="og:site_name" content="SoulBridge AI">
    
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="SoulBridge AI - Your Journey to Emotional Wellness">
    <meta name="twitter:description" content="Connect with AI companions designed for healing, growth, and spiritual guidance">
    <meta name="twitter:image" content="{{ url_for('static', filename='logos/IntroLogo.png', _external=True) }}">
    
    <!-- CRITICAL: Block rendering until intro styles are ready -->
    <style>
        /* Prevent flash during loading */
        html { opacity: 0; transition: opacity 0.3s ease; }
        html.ready { opacity: 1; }
        
        /* ULTRA CRITICAL: Beautiful black background with cyan accents */
        html, body {
            background: #000000 !important;
            background-attachment: fixed !important;
            background-size: 100% 100% !important;
        }
        
        /* CRITICAL: Intro page styling MUST load first */
        body, body.intro-page {
            background: #000000 !important;
            background-attachment: fixed !important;
            background-size: 100% 100% !important;
            min-height: 100vh !important;
            margin: 0 !important;
            padding: 0 !important;
            font-family: system-ui, -apple-system, sans-serif !important;
            color: #00ffff !important;
        }
        
        /* Force override any conflicting CSS */
        .intro-page {
            background: #000000 !important;
        }
    </style>
    <!-- Load CSS normally but override background only -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/themes.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/components.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
    
    <!-- IMMEDIATE styling script - runs before anything else -->
    <script>
        (function() {
            const gradient = 'linear-gradient(135deg, #0a0e1a 0%, #1a202c 25%, #2d3748 50%, #1a202c 75%, #0a0e1a 100%)';
            document.documentElement.style.background = gradient + ' !important';
            document.documentElement.style.backgroundAttachment = 'fixed';
            document.documentElement.style.backgroundSize = '100% 100%';
            console.log('🚀 IMMEDIATE intro styling applied');
        })();
    </script>
    
    <style>
        /* Enhanced intro page with beautiful black background */
        body {
            background: #000000 !important;
            background-attachment: fixed !important;
            background-size: 100% 100% !important;
            min-height: 100vh !important;
            position: relative !important;
        }
        
        /* Add stunning cyan animated background elements */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 15% 25%, rgba(0, 255, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 85% 75%, rgba(0, 255, 255, 0.12) 0%, transparent 45%),
                radial-gradient(circle at 45% 85%, rgba(0, 255, 255, 0.08) 0%, transparent 35%),
                radial-gradient(circle at 70% 15%, rgba(0, 255, 255, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: breathe 4s ease-in-out infinite alternate;
        }
        
        @keyframes breathe {
            0% { opacity: 0.6; }
            100% { opacity: 1; }
        }
        
        /* Improve container responsiveness and prevent stacking */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 120px 20px 40px 20px; /* More top padding to avoid nav overlap */
            min-height: calc(100vh - 80px); /* Account for navigation height */
            display: flex;
            flex-direction: column;
            justify-content: flex-start; /* Start from top instead of center */
            align-items: center;
            text-align: center;
            gap: 20px; /* Add consistent spacing between elements */
        }
        
        /* Ensure proper spacing for main elements */
        .container img {
            margin: 70px 0 25px 0 !important;
        }
        
        .container h1 {
            margin: 20px 0 15px 0 !important;
            font-weight: 600 !important;
            letter-spacing: -0.5px !important;
        }
        
        .container > p {
            margin: 15px auto 40px auto !important;
            max-width: 500px !important;
            line-height: 1.4 !important;
        }
        
        /* Enhanced cards with beautiful cyan glow */
        .card {
            background: rgba(0, 0, 0, 0.9) !important;
            backdrop-filter: blur(20px) !important;
            border: 2px solid rgba(0, 255, 255, 0.3) !important;
            transition: all 0.3s ease !important;
            box-shadow: 0 0 20px rgba(0, 255, 255, 0.1) !important;
        }
        
        .card:hover {
            transform: translateY(-5px) !important;
            border-color: rgba(0, 255, 255, 0.6) !important;
            box-shadow: 0 10px 40px rgba(0, 255, 255, 0.2) !important;
        }
        
        /* Beautiful cyan text styling */
        h1, h2, h3, h4, h5, h6 {
            color: #00ffff !important;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.3) !important;
        }
        
        p {
            color: #00ffff !important;
        }

        /* Add-on button styling */
        .addon-btn {
            background: rgba(15, 23, 42, 0.8) !important;
            border: 2px solid rgba(34, 211, 238, 0.3) !important;
            border-radius: 15px !important;
            padding: 20px !important;
            text-decoration: none !important;
            color: inherit !important;
            transition: all 0.3s ease !important;
            display: block !important;
            backdrop-filter: blur(10px) !important;
        }

        .addon-btn:hover {
            border-color: #22d3ee !important;
            transform: translateY(-5px) !important;
            box-shadow: 0 10px 30px rgba(34, 211, 238, 0.3) !important;
            background: rgba(34, 211, 238, 0.1) !important;
        }

        .addon-icon {
            font-size: 2.5rem !important;
            margin-bottom: 10px !important;
        }

        .addon-title {
            color: #22d3ee !important;
            font-size: 1.2rem !important;
            font-weight: 600 !important;
            margin-bottom: 8px !important;
        }

        .addon-desc {
            color: #94a3b8 !important;
            font-size: 0.9rem !important;
            line-height: 1.4 !important;
        }

        .addon-limit {
            margin-top: 8px;
            padding: 4px 8px;
            background: rgba(34, 211, 238, 0.2);
            border: 1px solid rgba(34, 211, 238, 0.4);
            border-radius: 12px;
            color: #22d3ee;
            font-size: 0.8rem;
            font-weight: 600;
            text-align: center;
        }
        
        /* Responsive adjustments */
        @media (max-width: 768px) {
            .container {
                padding: 100px 15px 30px 15px;
            }
            
            h1 {
                font-size: 2rem !important;
            }
            
            p {
                font-size: 1rem !important;
            }
        }
        
        /* Enhanced navigation bar with black and cyan theme */
        .top-nav {
            background: rgba(0, 0, 0, 0.95) !important;
            backdrop-filter: blur(20px) !important;
            border-bottom: 2px solid rgba(0, 255, 255, 0.3) !important;
            box-shadow: 0 2px 20px rgba(0, 255, 255, 0.1) !important;
        }
        
        /* Beautiful Sapphire cyan glow animation */
        @keyframes gentleGlow {
            0% { 
                box-shadow: 0 0 30px rgba(0, 255, 255, 0.4);
                transform: scale(1);
            }
            100% { 
                box-shadow: 0 0 50px rgba(0, 255, 255, 0.7);
                transform: scale(1.02);
            }
        }
        
        /* Trial Timer Styles */
        .hidden {
            display: none !important;
        }
        
        @keyframes pulse-gold {
            0% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(255, 215, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 215, 0, 0); }
        }
        
        /* Trial Badge */
        .trial-badge {
            background: linear-gradient(135deg, #ffd700, #ffb347);
            color: #000;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 12px;
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 4px;
            animation: pulse-gold 2s infinite;
            box-shadow: 0 2px 8px rgba(255, 215, 0, 0.3);
        }
    </style>
    
    <!-- Google AdSense -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3869471953521437"
         crossorigin="anonymous"></script>
</head>
<body class="intro-page" style="background: #000000 !important; background-attachment: fixed !important; background-size: 100% 100% !important; min-height: 100vh !important; margin: 0 !important; font-family: system-ui, -apple-system, sans-serif !important; color: #00ffff !important;">
    <!-- Navigation -->
    <div class="top-nav" style="position: fixed; top: 0; left: 0; right: 0; z-index: 1000; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center;">
        <!-- 🚀 Trial Timer - Only for growth/max users (free users use ads, no trials) -->
        {% if user_plan != 'free' %}
        <div id="trial-timer-container" style="display:none; position: fixed; top: 20px; right: 20px; z-index: 1500;">
            <div class="timer-glass-card">
                <div class="timer-glow-ring">
                    <svg width="140" height="140" class="timer-svg">
                        <!-- Background ring -->
                        <circle cx="70" cy="70" r="60" stroke="rgba(0, 255, 255, 0.1)" stroke-width="4" fill="none"/>
                        <!-- Progress ring -->
                        <circle id="timer-progress" cx="70" cy="70" r="60" stroke="url(#timerGradient)" stroke-width="6" fill="none" 
                                stroke-dasharray="377" stroke-dashoffset="0" stroke-linecap="round"
                                style="transform: rotate(-90deg); transform-origin: 50% 50%; transition: stroke-dashoffset 0.5s ease, stroke 0.3s ease;"/>
                        <!-- Gradient Definition -->
                        <defs>
                            <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#00ffff"/>
                                <stop offset="50%" style="stop-color:#00cc88"/>
                                <stop offset="100%" style="stop-color:#0099ff"/>
                            </linearGradient>
                            <linearGradient id="warningGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#ffaa00"/>
                                <stop offset="100%" style="stop-color:#ff8800"/>
                            </linearGradient>
                            <linearGradient id="criticalGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                                <stop offset="0%" style="stop-color:#ff4444"/>
                                <stop offset="100%" style="stop-color:#cc0000"/>
                            </linearGradient>
                            <filter id="glow">
                                <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
                                <feMerge> 
                                    <feMergeNode in="coloredBlur"/>
                                    <feMergeNode in="SourceGraphic"/> 
                                </feMerge>
                            </filter>
                        </defs>
                    </svg>
                    
                    <!-- Timer Text Content -->
                    <div class="timer-content">
                        <div id="trial-time-text" class="timer-display">5:00:00</div>
                        <div class="timer-label">TRIAL</div>
                        <div class="timer-status">Active</div>
                    </div>
                    
                    <!-- Pulse Animation Ring -->
                    <div class="pulse-ring"></div>
                </div>
            </div>
        </div>
        {% endif %}

        {% if user_plan != 'free' %}
        <style>
        /* 🎨 Beautiful Modern Timer Styles - Intro Page (Growth/Max only) */
        .timer-glass-card {
            background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(15, 23, 42, 0.9) 100%);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 20px;
            padding: 15px;
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 30px rgba(0, 255, 255, 0.2),
                inset 0 1px 0 rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .timer-glass-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 255, 0.5), transparent);
        }

        .timer-glow-ring {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .timer-svg {
            filter: drop-shadow(0 0 10px rgba(0, 255, 255, 0.3));
            animation: timerRotate 20s linear infinite;
        }

        .timer-content {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            z-index: 10;
        }

        .timer-display {
            font-size: 18px;
            font-weight: 700;
            color: #00ffff;
            text-shadow: 0 0 10px rgba(0, 255, 255, 0.8);
            margin-bottom: 2px;
            font-family: 'Courier New', monospace;
            letter-spacing: 1px;
        }

        .timer-label {
            font-size: 10px;
            font-weight: 600;
            color: rgba(0, 255, 255, 0.7);
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 1px;
        }

        .timer-status {
            font-size: 8px;
            color: #00cc88;
            font-weight: 500;
            opacity: 0.8;
            animation: statusPulse 2s ease-in-out infinite;
        }

        .pulse-ring {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 120px;
            height: 120px;
            border: 2px solid rgba(0, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            animation: pulseRing 3s ease-in-out infinite;
            pointer-events: none;
        }

        /* 🎬 Smooth Animations */
        @keyframes timerRotate {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulseRing {
            0%, 100% { 
                opacity: 0.3; 
                transform: translate(-50%, -50%) scale(1); 
            }
            50% { 
                opacity: 0.1; 
                transform: translate(-50%, -50%) scale(1.1); 
            }
        }

        @keyframes statusPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }

        /* 🎯 Responsive Design - Make timer smaller on intro page */
        #trial-timer-container {
            transform: scale(0.75);
            transform-origin: top right;
        }

        @media (max-width: 768px) {
            #trial-timer-container {
                top: 15px;
                right: 15px;
                transform: scale(0.65);
                transform-origin: top right;
            }
            
            .timer-display {
                font-size: 14px;
            }
            
            .timer-svg {
                width: 120px;
                height: 120px;
            }
        }

        /* 🌟 Hover Effects */
        .timer-glass-card:hover {
            border-color: rgba(0, 255, 255, 0.6);
            box-shadow: 
                0 25px 50px rgba(0, 0, 0, 0.5),
                0 0 50px rgba(0, 255, 255, 0.4),
                inset 0 1px 0 rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            transition: all 0.3s ease;
        }

        /* 🚨 Warning States */
        .timer-warning #timer-progress {
            stroke: url(#warningGradient) !important;
            animation: warningPulse 1s ease-in-out infinite;
        }

        .timer-critical #timer-progress {
            stroke: url(#criticalGradient) !important;
            animation: criticalPulse 0.5s ease-in-out infinite;
        }

        @keyframes warningPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes criticalPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Simple Timer Styles */
        .trial-status-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .simple-timer {
            background: rgba(0, 255, 255, 0.1);
            border: 1px solid rgba(0, 255, 255, 0.3);
            border-radius: 12px;
            padding: 4px 8px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            color: #00ffff;
            font-weight: bold;
            letter-spacing: 0.5px;
            text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
            opacity: 0.9;
        }
        
        .simple-timer.warning {
            background: rgba(255, 165, 0, 0.1);
            border-color: rgba(255, 165, 0, 0.3);
            color: #ffa500;
            text-shadow: 0 0 5px rgba(255, 165, 0, 0.5);
        }
        
        .simple-timer.critical {
            background: rgba(255, 69, 69, 0.1);
            border-color: rgba(255, 69, 69, 0.3);
            color: #ff4545;
            text-shadow: 0 0 5px rgba(255, 69, 69, 0.5);
            animation: criticalBlink 1s ease-in-out infinite alternate;
        }
        
        @keyframes criticalBlink {
            0% { opacity: 0.9; }
            100% { opacity: 0.6; }
        }
        </style>
        {% endif %}
        
        <!-- Right side buttons -->
        <div style="display: flex; gap: 15px; align-items: center;">
            
            <!-- Trial Badge - Only for growth/max users (free users use ads, no trials) -->
            {% if user_plan != 'free' %}
            <div class="trial-status-container">
                <span class="trial-badge" id="trial-badge" style="display: none;">
                    🕐 Trial Active
                </span>
                <div id="simple-timer" class="simple-timer" style="display: none;">
                    <span id="timer-display">5:00:00</span>
                </div>
            </div>
            {% endif %}
            <a href="/auth/logout" class="btn-danger">Logout</a>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="container">
        
        <!-- Branded Logo Section -->
        <div style="text-align: center; margin: 40px 0 15px 0;">
            <img src="{{ url_for('static', filename='logos/IntroLogo.png') }}" alt="SoulBridge AI Logo" 
                 style="width: 320px; height: auto; margin-bottom: 15px; 
                        filter: drop-shadow(0 8px 40px rgba(34, 211, 238, 0.5));
                        transition: all 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);"
                 onmouseover="this.style.transform='scale(1.1)'; this.style.filter='drop-shadow(0 15px 60px rgba(34, 211, 238, 0.8))'"
                 onmouseout="this.style.transform='scale(1)'; this.style.filter='drop-shadow(0 8px 40px rgba(34, 211, 238, 0.5))'">
        </div>

        <!-- Beautiful Sapphire Guide Bot Introduction -->
        <div style="display: flex; flex-direction: column; align-items: center; margin: 10px 0 30px 0;">
            <img src="{{ url_for('static', filename='logos/Sapphire.png') }}" alt="Sapphire Guide Bot" 
                 style="width: 280px; height: 280px; border-radius: 50%; 
                        border: 3px solid #00ffff; box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
                        margin-bottom: 15px; object-fit: contain;
                        animation: gentleGlow 3s ease-in-out infinite alternate;">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2 style="font-size: 1.3rem; color: #00ffff; margin-bottom: 6px; font-weight: 500; text-shadow: 0 0 8px rgba(0, 255, 255, 0.5);">👋 Meet Sapphire</h2>
                <p style="font-size: 0.95rem; color: #00ffff; margin: 0 0 12px 0; font-style: italic; opacity: 0.8;">Your step-by-step guide for finding features & navigating SoulBridge AI</p>
                <button onclick="toggleNavigationAssistant()" 
                        style="background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%); 
                               border: none; border-radius: 12px; padding: 10px 20px; 
                               color: #00ffff; font-weight: 600; font-size: 0.9rem;
                               cursor: pointer; transition: all 0.3s ease;
                               box-shadow: 0 4px 15px rgba(255, 0, 0, 0.3);
                               transform: translateY(0); text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);"
                        onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(255, 0, 0, 0.4)'"
                        onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(255, 0, 0, 0.3)'">
                    💎 Ask Sapphire for Help
                </button>
            </div>
        </div>
        
        <h1 style="font-size: 2.2rem; margin-bottom: 15px; font-weight: 600;">Welcome to SoulBridge AI</h1>
        <p style="font-size: 1rem; margin-bottom: 40px; opacity: 0.8; max-width: 500px;">Choose your AI companion for meaningful conversations and personal growth</p>
        
        
        <div style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-bottom: 40px;">
            <a href="/tiers" 
               style="background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%);
                      border: none; border-radius: 15px; padding: 16px 32px; 
                      color: #00ffff; font-weight: 700; font-size: 1.2rem;
                      text-decoration: none; cursor: pointer; transition: all 0.3s ease;
                      box-shadow: 0 8px 30px rgba(255, 0, 0, 0.5);
                      transform: translateY(0); display: inline-block;
                      text-shadow: 0 0 8px rgba(0, 255, 255, 0.6);"
               onmouseover="this.style.transform='translateY(-4px) scale(1.05)'; this.style.boxShadow='0 15px 40px rgba(255, 0, 0, 0.7)'"
               onmouseout="this.style.transform='translateY(0) scale(1)'; this.style.boxShadow='0 8px 30px rgba(255, 0, 0, 0.5)'">
                🌟 Choose Your AI Companion
            </a>
            <a href="/community-dashboard" 
               style="background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%); 
                      border: 2px solid rgba(0, 255, 255, 0.3); border-radius: 15px; padding: 18px 35px; 
                      color: #00ffff; font-weight: 600; font-size: 1.1rem;
                      text-decoration: none; cursor: pointer; transition: all 0.3s ease;
                      transform: translateY(0); display: inline-block;
                      text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
                      box-shadow: 0 4px 20px rgba(255, 0, 0, 0.3);"
               onmouseover="this.style.transform='translateY(-3px)'; this.style.borderColor='rgba(0, 255, 255, 0.6)'; this.style.boxShadow='0 8px 30px rgba(255, 0, 0, 0.5)'"
               onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(0, 255, 255, 0.3)'; this.style.boxShadow='0 4px 20px rgba(255, 0, 0, 0.3)'">
                🌍 Community
            </a>
            <a href="/profile" id="main-profile-button"
               style="background: linear-gradient(135deg, #ff0000 0%, #cc0000 100%); 
                      border: 2px solid rgba(0, 255, 255, 0.3); border-radius: 15px; padding: 18px 35px; 
                      color: #00ffff; font-weight: 600; font-size: 1.1rem;
                      text-decoration: none; cursor: pointer; transition: all 0.3s ease;
                      transform: translateY(0); display: inline-block;
                      text-shadow: 0 0 5px rgba(0, 255, 255, 0.5);
                      box-shadow: 0 4px 20px rgba(255, 0, 0, 0.3);"
               onmouseover="this.style.transform='translateY(-3px)'; this.style.borderColor='rgba(0, 255, 255, 0.6)'; this.style.boxShadow='0 8px 30px rgba(255, 0, 0, 0.5)'"
               onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(0, 255, 255, 0.3)'; this.style.boxShadow='0 4px 20px rgba(255, 0, 0, 0.3)'">
                👤 Profile
            </a>
        </div>

        <!-- Add-On Features Section -->
        <div id="addOnFeatures" style="margin: 40px 0; display: none;">
            <h3 style="color: #22d3ee; margin-bottom: 20px; font-size: 1.8rem; text-align: center;">🎯 Your Premium Add-Ons</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; max-width: 1000px; margin: 0 auto;">
                
                <a href="/voice-journaling" id="voiceJournalingBtn" class="addon-btn" style="display: none;">
                    <div class="addon-icon">🎙️</div>
                    <div class="addon-title">Voice Journaling</div>
                    <div class="addon-desc">Record and analyze emotional voice entries</div>
                    <div class="addon-limit" id="voiceLimit">50/month</div>
                </a>
                
                <a href="/relationship-profiles" id="relationshipBtn" class="addon-btn" style="display: none;">
                    <div class="addon-icon">💕</div>
                    <div class="addon-title">Relationship Profiles</div>
                    <div class="addon-desc">Track and improve your relationships</div>
                    <div class="addon-limit" id="relationshipLimit">10 profiles</div>
                </a>
                
                <a href="/emotional-meditations" id="meditationBtn" class="addon-btn" style="display: none;">
                    <div class="addon-icon">🧘</div>
                    <div class="addon-title">Emotional Meditations</div>
                    <div class="addon-desc">Guided meditations for healing</div>
                    <div class="addon-limit" id="meditationLimit">20/month</div>
                </a>
                
                <a href="/ai-image-generation" id="aiImageBtn" class="addon-btn" style="display: none;">
                    <div class="addon-icon">🎨</div>
                    <div class="addon-title">AI Image Generation</div>
                    <div class="addon-desc">Create stunning AI-generated images</div>
                    <div class="addon-limit" id="aiImageLimit">25/month</div>
                </a>
                
            </div>
            
            <div style="text-align: center; margin-top: 25px;">
                <a href="/subscription" 
                   style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); 
                          border: none; border-radius: 12px; padding: 12px 24px; 
                          color: white; font-weight: 600; font-size: 1rem;
                          text-decoration: none; cursor: pointer; transition: all 0.3s ease;
                          display: inline-block;
                          box-shadow: 0 4px 15px rgba(139, 92, 246, 0.3);"
                   onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(139, 92, 246, 0.4)'"
                   onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(139, 92, 246, 0.3)'">
                    🛍️ Get More Add-Ons
                </a>
            </div>
        </div>
        
        <!-- Security notice using your card styling -->
        <div class="card" style="max-width: 500px; text-align: left; padding: 20px;">
            <h4 style="text-align: center; margin-bottom: 15px;">🔒 Your Security Matters</h4>
            <p style="margin-bottom: 8px; font-size: 0.9rem;">• You'll be logged out when you close your browser</p>
            <p style="margin-bottom: 8px; font-size: 0.9rem;">• Always use "Logout" button on shared computers</p>
            <p style="margin-bottom: 0; font-size: 0.9rem;">• Your conversations are private and secure</p>
        </div>
    </div>
    
    <script src="{{ url_for('static', filename='js/login-fixed.js') }}"></script>
    <script>
        // Set sessionStorage flag since user successfully reached intro page (logged in)
        sessionStorage.setItem('loggedIn', 'true');
        console.log('✅ INTRO: Set sessionStorage loggedIn flag - user is authenticated');
        
        // AGGRESSIVE intro page styling enforcement
        function forceIntroStyling() {
            const body = document.body;
            const html = document.documentElement;
            
            // Force styles on both html and body
            const gradient = 'linear-gradient(135deg, #0a0e1a 0%, #1a202c 25%, #2d3748 50%, #1a202c 75%, #0a0e1a 100%)';
            
            html.style.background = gradient;
            html.style.backgroundAttachment = 'fixed';
            html.style.backgroundSize = '100% 100%';
            
            body.style.background = gradient;
            body.style.backgroundAttachment = 'fixed';
            body.style.backgroundSize = '100% 100%';
            body.style.minHeight = '100vh';
            body.style.margin = '0';
            body.style.padding = '0';
            body.style.fontFamily = 'system-ui, -apple-system, sans-serif';
            body.style.color = '#22d3ee';
            
            // Override any existing classes
            body.className = 'intro-page';
            
            console.log('🎨 AGGRESSIVE intro page styling applied');
        }
        
        // Apply immediately - before DOM is even ready
        forceIntroStyling();
        
        // Show page when everything is truly ready
        function showIntroWhenReady() {
            forceIntroStyling();
            document.documentElement.classList.add('ready');
            console.log('✅ Intro page fully ready - showing with fade-in');
        }
        
        // Wait for both DOM and all scripts to load
        let domReady = false;
        let scriptsReady = false;
        
        document.addEventListener('DOMContentLoaded', function() {
            domReady = true;
            console.log('📄 DOM ready');
            checkIfFullyReady();
        });
        
        window.addEventListener('load', function() {
            scriptsReady = true;
            console.log('📜 Scripts ready');
            checkIfFullyReady();
        });
        
        function checkIfFullyReady() {
            if (domReady && scriptsReady) {
                // Small delay to ensure all dynamic content is added
                setTimeout(showIntroWhenReady, 200);
            }
        }
        
        // Multiple emergency fallbacks to ensure page always shows
        setTimeout(() => {
            if (!document.documentElement.classList.contains('ready')) {
                console.log('⚠️ Emergency fallback 1: Showing intro page after 1s');
                showIntroWhenReady();
            }
        }, 1000);
        
        setTimeout(() => {
            if (!document.documentElement.classList.contains('ready')) {
                console.log('🚨 Emergency fallback 2: Force showing intro page after 2s');
                document.documentElement.style.opacity = '1';
                document.documentElement.classList.add('ready');
            }
        }, 2000);
        
        // Ultimate safety: ensure page is ALWAYS visible after 3 seconds
        setTimeout(() => {
            document.documentElement.style.opacity = '1';
            document.documentElement.style.visibility = 'visible';
            console.log('🛡️ Ultimate safety: Page is now guaranteed visible');
        }, 3000);
        
        // Apply styling on focus when navigating back
        window.addEventListener('focus', forceIntroStyling);
        
        // Show page immediately on any user interaction
        ['click', 'keydown', 'touchstart', 'mousemove'].forEach(event => {
            document.addEventListener(event, function() {
                if (!document.documentElement.classList.contains('ready')) {
                    console.log('👆 User interaction detected - showing page immediately');
                    showIntroWhenReady();
                }
            }, { once: true });
        });
        
        // Remove any duplicate profile buttons on page load
        document.addEventListener('DOMContentLoaded', function() {
            const profileButtons = document.querySelectorAll('a[href="/profile"]');
            console.log(`🔍 Found ${profileButtons.length} profile buttons`);
            
            if (profileButtons.length > 1) {
                // Keep only the main profile button (the one with ID)
                profileButtons.forEach((button, index) => {
                    if (button.id !== 'main-profile-button') {
                        console.log(`🗑️ Removing duplicate profile button ${index}`);
                        button.remove();
                    }
                });
            }
        });
        
        // Intro page uses default night mode - no theme switching needed
        console.log('📄 Intro page loaded - using default styling');
        
        // Add Sapphire navigation assistant function
        function toggleNavigationAssistant() {
            // Create interactive modal for Sapphire help
            const modal = document.createElement('div');
            modal.id = 'sapphireModal';
            modal.style.cssText = `
                position: fixed; top: 0; left: 0; width: 100%; height: 100%;
                background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(10px);
                display: flex; justify-content: center; align-items: center;
                z-index: 10000; animation: fadeIn 0.3s ease;
            `;
            
            modal.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #0a0e1a 0%, #1a202c 100%);
                    border: 2px solid rgba(34, 211, 238, 0.3);
                    border-radius: 20px; padding: 30px; max-width: 500px; width: 90%;
                    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
                    animation: slideUp 0.3s ease;
                ">
                    <div style="text-align: center; margin-bottom: 25px;">
                        <img src="/static/logos/Sapphire.png" alt="Sapphire" 
                             style="width: 60px; height: 60px; border-radius: 50%; margin-bottom: 15px; border: 2px solid #22d3ee;">
                        <h3 style="color: #22d3ee; margin: 0 0 10px 0;">💎 Ask Sapphire</h3>
                        <p style="color: #94a3b8; margin: 0 0 15px 0; font-size: 0.9rem;">Your step-by-step navigation guide is here!</p>
                        
                        <div style="display: flex; justify-content: space-around; margin-bottom: 20px; text-align: center;">
                            <div style="flex: 1; padding: 10px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">💎</div>
                                <p style="font-size: 0.75rem; color: #94a3b8; margin: 0;">Navigation Help</p>
                            </div>
                            <div style="flex: 1; padding: 10px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">💬</div>
                                <p style="font-size: 0.75rem; color: #94a3b8; margin: 0;">Deep Conversations</p>
                            </div>
                            <div style="flex: 1; padding: 10px;">
                                <div style="font-size: 1.5rem; margin-bottom: 5px;">⭐</div>
                                <p style="font-size: 0.75rem; color: #94a3b8; margin: 0;">Personal Growth</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-bottom: 20px;">
                        <input type="text" id="sapphireQuestion" placeholder="Ask me anything about SoulBridge AI..." 
                               style="width: 100%; padding: 15px; border: 2px solid rgba(34, 211, 238, 0.3);
                                      border-radius: 12px; background: rgba(255, 255, 255, 0.1);
                                      color: white; font-size: 1rem; outline: none;
                                      backdrop-filter: blur(10px);"
                               onkeypress="if(event.key==='Enter') askSapphire()">
                        <button onclick="askSapphire()" 
                                style="width: 100%; margin-top: 15px; padding: 15px;
                                       background: linear-gradient(135deg, #22d3ee 0%, #0891b2 100%);
                                       border: none; border-radius: 12px; color: white;
                                       font-weight: 600; cursor: pointer; transition: all 0.3s ease;"
                                onmouseover="this.style.transform='translateY(-2px)'"
                                onmouseout="this.style.transform='translateY(0)'">
                            Ask Sapphire
                        </button>
                    </div>
                    
                    <div style="background: rgba(34, 211, 238, 0.1); border-radius: 12px; padding: 15px; margin-bottom: 20px;">
                        <h4 style="color: #22d3ee; margin: 0 0 10px 0; font-size: 0.9rem;">💡 Try asking:</h4>
                        <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                            <button onclick="quickAsk('How do I reset my password?')" class="quickBtn">Reset Password</button>
                            <button onclick="quickAsk('Where are my settings?')" class="quickBtn">Settings</button>
                            <button onclick="quickAsk('How do I choose a companion?')" class="quickBtn">Choose Companion</button>
                            <button onclick="quickAsk('Where is billing?')" class="quickBtn">Billing</button>
                        </div>
                    </div>
                    
                    <div id="sapphireResponse" style="
                        background: rgba(255, 255, 255, 0.05); border-radius: 12px; 
                        padding: 15px; margin-bottom: 20px; display: none;
                        border-left: 4px solid #22d3ee;
                    ">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <img src="/static/logos/Sapphire.png" alt="Sapphire" 
                                 style="width: 24px; height: 24px; border-radius: 50%; margin-right: 10px;">
                            <strong style="color: #22d3ee;">Sapphire:</strong>
                        </div>
                        <p id="sapphireAnswer" style="color: #e2e8f0; margin: 0; line-height: 1.4;"></p>
                    </div>
                    
                    <button onclick="closeSapphireModal()" 
                            style="width: 100%; padding: 12px; background: rgba(255, 255, 255, 0.1);
                                   border: 2px solid rgba(255, 255, 255, 0.2); border-radius: 12px;
                                   color: #94a3b8; cursor: pointer; transition: all 0.3s ease;"
                            onmouseover="this.style.background='rgba(255, 255, 255, 0.2)'"
                            onmouseout="this.style.background='rgba(255, 255, 255, 0.1)'">
                        Close
                    </button>
                </div>
            `;
            
            // Add styles for quick buttons
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
                @keyframes slideUp { from { transform: translateY(30px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
                @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
                .quickBtn {
                    padding: 6px 12px; background: rgba(34, 211, 238, 0.2);
                    border: 1px solid rgba(34, 211, 238, 0.3); border-radius: 20px;
                    color: #22d3ee; font-size: 0.8rem; cursor: pointer;
                    transition: all 0.2s ease; white-space: nowrap;
                }
                .quickBtn:hover {
                    background: rgba(34, 211, 238, 0.3); transform: translateY(-1px);
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(modal);
            
            // Focus on input
            setTimeout(() => document.getElementById('sapphireQuestion').focus(), 100);
        }
        
        function quickAsk(question) {
            document.getElementById('sapphireQuestion').value = question;
            askSapphire();
        }
        
        function askSapphire() {
            const question = document.getElementById('sapphireQuestion').value.trim();
            if (!question) return;
            
            // Show response area
            const responseDiv = document.getElementById('sapphireResponse');
            const answerP = document.getElementById('sapphireAnswer');
            responseDiv.style.display = 'block';
            
            // Get current page context
            const currentPage = window.location.pathname;
            const isIntroPage = currentPage === '/' || currentPage.includes('intro');
            
            // Enhanced Sapphire with comprehensive website knowledge
            let answer = getSapphireResponse(question, currentPage);
            
            answerP.textContent = answer;
            
            // Clear input
            document.getElementById('sapphireQuestion').value = '';
        }
        
        function getSapphireResponse(question, currentPage) {
            const q = question.toLowerCase();
            
            // Website navigation help
            if (q.includes('where') || q.includes('find') || q.includes('navigate') || q.includes('locate')) {
                if (q.includes('faq') || q.includes('help') || q.includes('support') || q.includes('questions')) {
                    return "❓ FAQ & Help: From here, click '👤 Profile' button above → scroll down and click '📚 Help & FAQ' button. This will take you to the complete help section with detailed guides and answers!";
                } else if (q.includes('profile') || q.includes('account')) {
                    return "🏠 From here: Click '👤 Profile' button above to access your account settings, profile image, display name, subscription details, and more!";
                } else if (q.includes('community') || q.includes('communities')) {
                    return "🌍 From here: Click '🌍 Community' button above to join wellness communities, participate in challenges, find peer support, and track your community activity!";
                } else if (q.includes('companion') || q.includes('character') || q.includes('ai')) {
                    return "🌟 From here: Click '🌟 Choose Your AI Companion' button above to select from Blayzo, Violet, Crimson, Blayzica, Blayzia, and more! Each has unique personalities and specialties.";
                } else if (q.includes('chat') || q.includes('talk') || q.includes('conversation')) {
                    return "💬 To start chatting: First choose your AI companion with the '🌟 Choose Your AI Companion' button, then you'll be able to start meaningful conversations!";
                } else if (q.includes('decoder') || q.includes('decode')) {
                    return "🧠 Decoder Mode: Available in chat - click the Decoder button to analyze text, decode emotions, get insights, and more! Great for understanding complex messages or situations.";
                } else if (q.includes('subscription') || q.includes('upgrade') || q.includes('billing')) {
                    return "💳 Subscription: Go to /subscription page or Profile → Subscription section to upgrade from Free to Growth/Max plans. Manage billing and access premium features!";
                }
            }
            
            // Feature-specific help
            if (q.includes('upload') || q.includes('image') || q.includes('picture') || q.includes('photo')) {
                return "📷 Profile Images: Go to Profile page → scroll to 'User Information' → click '📷 Upload Profile Picture'. Supports PNG, JPG, GIF, WebP up to 5MB. Your images are saved permanently!";
            }
            
            if (q.includes('password') || q.includes('reset') || q.includes('forgot')) {
                return "🔒 Password Help: Use 'Forgot Password' on login page, or go to Profile → Account Settings to change your password. Always use the Logout button on shared computers!";
            }
            
            if (q.includes('community') || q.includes('join') || q.includes('wellness')) {
                return "🏘️ Communities: Visit Community Dashboard to join wellness groups like Mindfulness, Fitness, Anxiety Support, and more! You can also create your own communities and participate in challenges.";
            }
            
            if (q.includes('companion') || q.includes('personality') || q.includes('blayzo') || q.includes('violet')) {
                return "🌟 AI Companions: Choose from 6 unique personalities - Blayzo (wise mentor), Violet (gentle nurturing), Crimson (passionate motivator), Blayzica (empathetic support), Blayzia (mystical guide), Blayzion (creative innovator). Each offers different conversation styles!";
            }
            
            if (q.includes('subscription') || q.includes('billing') || q.includes('payment') || q.includes('upgrade')) {
                return "💳 Subscription: Go to Profile → Subscription section to upgrade from Free to Growth or Max plans. Manage billing, view usage, and access premium features!";
            }
            
            if (q.includes('dark') || q.includes('theme') || q.includes('colors') || q.includes('appearance')) {
                return "🎨 Appearance: SoulBridge AI uses a beautiful black background with cyan accents for a calming, focused experience. Theme settings may be available in your Profile page!";
            }
            
            if (q.includes('error') || q.includes('404') || q.includes('broken') || q.includes('not working')) {
                return "🔧 Troubleshooting: If you see 404 errors or issues, try refreshing the page. For profile image issues, re-upload your image. For persistent problems, check your internet connection or contact support!";
            }
            
            if (q.includes('support') || q.includes('help') || q.includes('contact')) {
                return "📧 Support: Click '👤 Profile' button → scroll down and click '📚 Help & FAQ' for detailed guides, or click '🐛 Report Issue' to email support. I'm also here 24/7 to help you navigate SoulBridge AI!";
            }
            
            if (q.includes('logout') || q.includes('sign out') || q.includes('exit')) {
                return "🚪 Logout: Always use the 'Logout' button (top-right on most pages) for security. Your session will automatically expire after 30 minutes of inactivity to protect your privacy.";
            }
            
            if (q.includes('security') || q.includes('privacy') || q.includes('safe')) {
                return "🔒 Security: Your conversations are private and secure. Sessions auto-expire when you close your browser. Always logout on shared computers. Your data is encrypted and protected!";
            }
            
            // Page-specific contextual help
            if (currentPage === '/' || currentPage.includes('intro')) {
                if (q.includes('start') || q.includes('begin') || q.includes('first')) {
                    return "🚀 Getting Started: Welcome! First, click '🌟 Choose Your AI Companion' to select your perfect conversation partner. Then visit '🌍 Community' to join wellness groups, and '👤 Profile' to customize your account!";
                }
            }
            
            // Motivational and wellness guidance
            if (q.includes('wellness') || q.includes('mental health') || q.includes('support')) {
                return "💙 Wellness Support: SoulBridge AI offers communities for anxiety, depression, meditation, fitness, and more. Choose a companion that resonates with you, join supportive communities, and participate in wellness challenges!";
            }
            
            if (q.includes('how') && (q.includes('work') || q.includes('use'))) {
                return "🌟 How SoulBridge Works: 1) Choose your AI companion personality 2) Join wellness communities that interest you 3) Start conversations and participate in challenges 4) Track your wellness journey in your profile. I'm here to guide you through everything!";
            }
            
            // Default comprehensive response
            return `💎 I'm Sapphire, your SoulBridge AI navigation guide! I'll show you where to find:

🌟 Choosing AI companions (Blayzo, Violet, Crimson, etc.)
🏘️ Joining wellness communities and challenges  
👤 Managing your profile and settings
💬 Starting conversations and getting support
🔒 Account security and troubleshooting
📧 Contacting support when needed

What specific area would you like help with? I know every feature of SoulBridge AI and I'm here to guide your wellness journey!`;
        }
        
        function closeSapphireModal() {
            const modal = document.getElementById('sapphireModal');
            if (modal) {
                modal.style.animation = 'fadeOut 0.3s ease';
                setTimeout(() => modal.remove(), 300);
            }
        }
        
        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.id === 'sapphireModal') {
                closeSapphireModal();
            }
        });
        
        // BANKING SECURITY: Clear session when user navigates away (like bank sites)
        let sessionCleared = false;
        let navigatingInternally = false;
        
        // Track internal navigation to avoid clearing session for app navigation
        document.addEventListener('click', function(e) {
            const link = e.target.closest('a, button');
            if (link) {
                // Check for internal links
                if (link.href) {
                    try {
                        const url = new URL(link.href);
                        const currentHost = window.location.hostname;
                        if (url.hostname === currentHost || url.hostname === 'www.soulbridgeai.com' || url.hostname === 'soulbridgeai.com') {
                            console.log('🔄 Internal navigation detected:', url.pathname);
                            navigatingInternally = true;
                            setTimeout(() => { navigatingInternally = false; }, 2000);
                        }
                    } catch (e) {
                        // Invalid URL, might be relative - assume internal
                        navigatingInternally = true;
                        setTimeout(() => { navigatingInternally = false; }, 2000);
                    }
                }
                // Check for buttons that trigger navigation (like profile button)
                else if (link.onclick || link.getAttribute('onclick')) {
                    console.log('🔄 Button navigation detected');
                    navigatingInternally = true;
                    setTimeout(() => { navigatingInternally = false; }, 2000);
                }
            }
        });
        
        // Also track programmatic navigation
        const originalPushState = history.pushState;
        const originalReplaceState = history.replaceState;
        
        history.pushState = function() {
            navigatingInternally = true;
            setTimeout(() => { navigatingInternally = false; }, 2000);
            return originalPushState.apply(history, arguments);
        };
        
        history.replaceState = function() {
            navigatingInternally = true;
            setTimeout(() => { navigatingInternally = false; }, 2000);
            return originalReplaceState.apply(history, arguments);
        };
        
        function clearSession() {
            // Only clear session if not navigating internally within the app
            if (!sessionCleared && !navigatingInternally) {
                sessionCleared = true;
                console.log('🔒 SECURITY: Clearing session due to external navigation/page close');
                fetch('/api/clear-session', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    keepalive: true // Ensures request completes even if page is closing
                }).catch(e => console.log('Session clear request sent'));
            } else if (navigatingInternally) {
                console.log('🔄 SECURITY: Keeping session for internal navigation');
            }
        }
        
        // DISABLED: Overly aggressive session clearing was causing login loops
        // Only clear session on explicit logout, not on navigation/tab switching
        // window.addEventListener('beforeunload', clearSession);
        // window.addEventListener('pagehide', clearSession);
        // window.addEventListener('visibilitychange', function() {
        //     if (document.visibilityState === 'hidden') {
        //         clearSession();
        //     }
        // });
        // window.addEventListener('blur', clearSession);
        
        // Netflix-style "Are you still there?" warning (9 minutes - before 10 minute server timeout)
        setTimeout(() => {
            showStillThereModal();
        }, 9 * 60 * 1000); // 9 minutes
        
        function showStillThereModal() {
            // Create Netflix-style overlay
            const overlay = document.createElement('div');
            overlay.id = 'stillThereOverlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                backdrop-filter: blur(10px);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10000;
                animation: fadeIn 0.3s ease;
            `;
            
            overlay.innerHTML = `
                <div style="
                    background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
                    border: 2px solid #00ffff;
                    border-radius: 16px;
                    padding: 40px;
                    text-align: center;
                    max-width: 400px;
                    box-shadow: 0 20px 40px rgba(0, 255, 255, 0.2);
                    animation: slideIn 0.3s ease;
                ">
                    <div style="font-size: 2rem; margin-bottom: 20px;">👋</div>
                    <h2 style="color: #00ffff; margin-bottom: 15px; font-size: 1.5rem;">Are you still there?</h2>
                    <p style="color: #94a3b8; margin-bottom: 25px; line-height: 1.6;">
                        Your session will expire in <span id="countdown" style="color: #00ffff; font-weight: bold;">60</span> seconds for security.
                    </p>
                    <div style="display: flex; gap: 15px; justify-content: center;">
                        <button onclick="continueSession()" style="
                            background: linear-gradient(135deg, #00ffff, #0891b2);
                            color: #000;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                            Yes, I'm here
                        </button>
                        <button onclick="logOut()" style="
                            background: transparent;
                            color: #94a3b8;
                            border: 1px solid #374151;
                            padding: 12px 24px;
                            border-radius: 8px;
                            cursor: pointer;
                            transition: all 0.3s ease;
                        " onmouseover="this.style.borderColor='#6b7280'" onmouseout="this.style.borderColor='#374151'">
                            Log me out
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Start countdown
            let timeLeft = 60;
            const countdownElement = document.getElementById('countdown');
            const countdownInterval = setInterval(() => {
                timeLeft--;
                if (countdownElement) {
                    countdownElement.textContent = timeLeft;
                }
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    logOut();
                }
            }, 1000);
            
            // Store interval so we can clear it
            overlay.countdownInterval = countdownInterval;
        }
        
        function continueSession() {
            // Remove the modal
            const overlay = document.getElementById('stillThereOverlay');
            if (overlay) {
                clearInterval(overlay.countdownInterval);
                overlay.remove();
            }
            
            // Refresh the session by making a simple request
            fetch('/api/session-refresh', { method: 'POST' })
                .then(() => {
                    console.log('✅ Session refreshed - you can continue using the site');
                    // Set up the next warning in 9 minutes
                    setTimeout(() => {
                        showStillThereModal();
                    }, 9 * 60 * 1000);
                })
                .catch(() => {
                    console.log('Session refresh failed, but continuing anyway');
                });
        }
        
        function logOut() {
            // Clear session and redirect to login
            clearSession();
            window.location.href = '/login';
        }
        
        console.log('🔒 BANKING SECURITY: Session protection active - sessions clear on navigation/inactivity');

        // Load and display premium features based on user plan
        async function loadUserAddons() {
            try {
                const response = await fetch('/api/user/status', {
                    credentials: 'include'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const addOnSection = document.getElementById('addOnFeatures');
                    const userPlan = result.plan || 'free';
                    const trialActive = result.trial_active || false;
                    
                    console.log('🔍 User plan for premium features:', userPlan, 'trial:', trialActive);
                    
                    // Show premium features based on plan (Growth/Max only)  
                    if (userPlan === 'growth' || userPlan === 'max') {
                        // Growth and Max users get all premium features
                        document.getElementById('voiceJournalingBtn').style.display = 'block';
                        document.getElementById('relationshipBtn').style.display = 'block';
                        document.getElementById('meditationBtn').style.display = 'block';
                        document.getElementById('aiImageBtn').style.display = 'block';
                        
                        // Update limits based on plan
                        if (userPlan === 'max') {
                            // Max users get unlimited
                            document.getElementById('voiceLimit').textContent = '∞ Unlimited';
                            document.getElementById('relationshipLimit').textContent = '∞ Unlimited';
                            document.getElementById('meditationLimit').textContent = '∞ Unlimited';
                            document.getElementById('aiImageLimit').textContent = '∞ Unlimited';
                        } else {
                            // Growth users get limited amounts
                            document.getElementById('voiceLimit').textContent = '50/month';
                            document.getElementById('relationshipLimit').textContent = '10 profiles';
                            document.getElementById('meditationLimit').textContent = '20/month';
                            document.getElementById('aiImageLimit').textContent = '25/month';
                        }
                        
                        // Show the entire add-on section
                        addOnSection.style.display = 'block';
                        
                        console.log('✨ Premium features unlocked for plan:', userPlan);
                    } else {
                        // Foundation users see nothing (features hidden)
                        console.log('📝 Free user - premium features hidden');
                    }
                }
                
            } catch (error) {
                console.error('Error loading premium features:', error);
            }
        }

        // Load add-ons when page is ready
        document.addEventListener('DOMContentLoaded', loadUserAddons);

        // ====== DISABLED OLD TRIAL TIMER SYSTEM - Using new system to prevent conflicts ======
        // DISABLED: const ring = document.querySelector('.progress-ring-circle');
        // DISABLED: const ringText = document.getElementById('ring-text');
        // DISABLED: const ringWrapper = document.getElementById('trial-ring-container');

        // ✨ NEW ENHANCED TIMER SYSTEM - Simple and conflict-free
        let timerUpdateInterval;

        // Trial functions - only for growth/max users
        {% if user_plan != 'free' %}
        function initializeEnhancedTimer() {
            const container = document.getElementById('trial-timer-container');
            if (!container) return;

            console.log('🚀 Initializing enhanced timer on intro page');
            
            // Beautiful entrance animation
            container.style.display = 'block';
            container.style.opacity = '0';
            container.style.transform = 'scale(0.8) translateY(-20px)';
            container.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
            
            setTimeout(() => {
                container.style.opacity = '1';
                container.style.transform = 'scale(1) translateY(0)';
            }, 100);
        }

        function updateSimpleTimer(trialRemaining) {
            const timerElement = document.getElementById('simple-timer');
            const displayElement = document.getElementById('timer-display');
            
            if (!timerElement || !displayElement) return;
            
            if (trialRemaining <= 0) {
                timerElement.style.display = 'none';
                return;
            }
            
            // Show timer
            timerElement.style.display = 'block';
            
            // Calculate time components (auto-detect seconds vs milliseconds)
            const totalSeconds = Math.floor(trialRemaining > 1000000 ? trialRemaining / 1000 : trialRemaining);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            // Update display
            displayElement.textContent = `${hours}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            
            // Update warning states
            timerElement.classList.remove('warning', 'critical');
            const timeInSeconds = trialRemaining > 1000000 ? trialRemaining / 1000 : trialRemaining;
            if (timeInSeconds < 600) { // < 10 minutes
                timerElement.classList.add('critical');
            } else if (timeInSeconds < 1800) { // < 30 minutes
                timerElement.classList.add('warning');
            }
        }
        {% endif %}

        async function refreshUserStatus() {
            try {
                const res = await fetch('/api/user-info');
                const data = await res.json();

                if (!data.success) {
                    console.error('Failed to get user info:', data.error);
                    return;
                }

                const { trial_active, trial_remaining, effective_plan, trial_used_permanently } = data;

                // Skip trial logic for free users (they use ads, not trials)
                const userPlan = '{{ user_plan or "free" }}';
                if (userPlan === 'free') {
                    console.log('🚫 Skipping trial logic - free user uses ads');
                    return;
                }

                // Update trial badge and simple timer
                const trialBadge = document.getElementById('trial-badge');
                const timerElement = document.getElementById('simple-timer');
                
                if (trial_active && trial_remaining > 0) {
                    // Show trial badge and update timer
                    if (trialBadge) trialBadge.style.display = 'inline-flex';
                    updateSimpleTimer(trial_remaining);
                } else {
                    // AGGRESSIVE TIMER CLEANUP - Remove all timer elements permanently
                    if (trialBadge) {
                        trialBadge.remove(); // Completely remove from DOM
                    }
                    if (timerElement) {
                        timerElement.remove(); // Completely remove from DOM
                    }
                    
                    // Remove enhanced timer container completely
                    const enhancedTimer = document.getElementById('trial-timer-container');
                    if (enhancedTimer) {
                        enhancedTimer.remove(); // Completely remove from DOM
                    }
                    
                    // Find and remove ALL timer-related elements
                    const allTimerElements = document.querySelectorAll('[id*="timer"], [class*="timer"], [id*="trial"], [class*="trial"]');
                    allTimerElements.forEach(el => {
                        if (!el.closest('.action-btn') && !el.closest('.card')) { // Don't remove action buttons or cards
                            console.log('🗑️ INTRO: Removing timer element:', el.id || el.className);
                            el.remove();
                        }
                    });
                    
                    console.log('🔒 INTRO: ALL timer elements permanently removed - trial expired');
                    
                    // Auto refresh to update companion access
                    setTimeout(() => {
                        window.location.reload();
                    }, 1000);
                }


            } catch (error) {
                console.error('Error refreshing user status:', error);
            }
        }


        // DISABLED: Start refreshing user status - causing timer flickering
        // setInterval(refreshUserStatus, 5000);  // auto refresh every 5 sec - DISABLED
        refreshUserStatus(); // Run once on load only
    </script>
    <script src="/static/js/mini-assistant-modal.js"></script>
</body>
</html>