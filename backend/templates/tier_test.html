<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tier Testing - SoulBridge AI</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 30px; background: #000; color: #fff; }
        .container { max-width: 900px; margin: auto; }
        .tier-card { background: #1a1a1a; padding: 25px; margin: 20px 0; border-radius: 15px; border: 2px solid #22d3ee; }
        .tier-card.max { border-color: #fbbf24; }
        .tier-card.growth { border-color: #22c55e; }
        .tier-card.free { border-color: #ef4444; }
        .test-btn { background: #22d3ee; color: #000; padding: 12px 25px; margin: 10px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 14px; }
        .test-btn.max { background: #fbbf24; }
        .test-btn.growth { background: #22c55e; }
        .test-btn.free { background: #ef4444; color: #fff; }
        .test-btn:hover { opacity: 0.8; transform: translateY(-2px); }
        .result { background: #2a2a2a; padding: 15px; margin: 15px 0; border-radius: 8px; font-family: monospace; font-size: 13px; }
        h1 { color: #22d3ee; text-align: center; margin-bottom: 10px; }
        h2 { color: #fbbf24; margin-bottom: 15px; }
        .status { background: #065f46; color: #ecfdf5; padding: 10px; border-radius: 5px; margin: 10px 0; }
        .feature-links { margin-top: 20px; padding: 15px; background: #2563eb; border-radius: 10px; }
        .feature-links a { color: #fff; text-decoration: none; margin: 0 15px; font-weight: bold; }
        .feature-links a:hover { text-decoration: underline; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Tier System Tester</h1>
        <p style="text-align: center; color: #94a3b8; margin-bottom: 30px;">
            Test the SoulBridge AI tier system - manually upgrade to test Growth and Max tiers!
        </p>
        
        <div id="current-status" class="status">
            Current Tier: <span id="current-tier">Loading...</span>
        </div>
        
        <!-- Max Tier -->
        <div class="tier-card max">
            <h2>üî¥ Max Tier (Enterprise)</h2>
            <p><strong>Unlimited access</strong> to all features - decoder, fortune teller, horoscope</p>
            <button class="test-btn max" onclick="upgradeTo('enterprise')">Upgrade to Max Tier</button>
            <button class="test-btn" onclick="testAPI('enterprise')">Test Max API</button>
            <div id="enterprise-result" class="result" style="display: none;"></div>
        </div>
        
        <!-- Growth Tier -->  
        <div class="tier-card growth">
            <h2>üîµ Growth Tier (Premium)</h2>
            <p><strong>Enhanced limits:</strong> 15 decodes, 8 fortunes, 10 horoscopes per day</p>
            <button class="test-btn growth" onclick="upgradeTo('premium')">Upgrade to Growth Tier</button>
            <button class="test-btn" onclick="testAPI('premium')">Test Growth API</button>
            <div id="premium-result" class="result" style="display: none;"></div>
        </div>
        
        <!-- Free Tier -->
        <div class="tier-card free">
            <h2>üü¢ Free Tier (Foundation)</h2>
            <p><strong>Basic limits:</strong> 5 decodes, 5 fortunes, 5 horoscopes, 5 creative writer per day</p>
            <button class="test-btn free" onclick="upgradeTo('foundation')">Reset to Free Tier</button>
            <button class="test-btn" onclick="testAPI('foundation')">Test Free API</button>
            <div id="foundation-result" class="result" style="display: none;"></div>
        </div>
        
        <!-- Feature Links -->
        <div class="feature-links">
            <strong>After upgrading, test these features:</strong>
            <a href="/decoder" target="_blank">üß† Decoder</a>
            <a href="/fortune" target="_blank">üîÆ Fortune Teller</a>
            <a href="/horoscope" target="_blank">‚≠ê Horoscope</a>
        </div>
    </div>

    <script>
        // Get current tier status on page load
        getCurrentTier();
        
        async function getCurrentTier() {
            try {
                const response = await fetch('/api/decoder/check-limit');
                const result = await response.json();
                document.getElementById('current-tier').textContent = 
                    result.effective_plan || 'Not Set';
            } catch (error) {
                document.getElementById('current-tier').textContent = 'Error loading';
            }
        }
        
        async function upgradeTo(tier) {
            try {
                let endpoint;
                if (tier === 'enterprise') endpoint = '/debug/upgrade-to-max';
                else if (tier === 'premium') endpoint = '/debug/upgrade-to-growth';
                else endpoint = '/debug/upgrade-to-free';
                
                const response = await fetch(endpoint, { method: 'POST' });
                const result = await response.json();
                
                if (result.success) {
                    document.getElementById('current-tier').textContent = tier;
                    alert(`Successfully upgraded to ${tier} tier! Now test the features.`);
                    
                    // Auto-test the API
                    setTimeout(() => testAPI(tier), 500);
                } else {
                    alert(`Upgrade failed: ${result.error}`);
                }
            } catch (error) {
                alert(`Error: ${error.message}`);
            }
        }
        
        async function testAPI(tier) {
            try {
                // Test all three APIs
                const [decoderRes, fortuneRes, horoscopeRes] = await Promise.all([
                    fetch('/api/decoder/check-limit'),
                    fetch('/api/fortune/check-limit'),
                    fetch('/api/horoscope/check-limit')
                ]);
                
                const [decoder, fortune, horoscope] = await Promise.all([
                    decoderRes.json(),
                    fortuneRes.json(),
                    horoscopeRes.json()
                ]);
                
                const result = {
                    tier: tier,
                    decoder: {
                        effective_plan: decoder.effective_plan,
                        daily_limit: decoder.daily_limit,
                        usage_today: decoder.usage_today
                    },
                    fortune: {
                        effective_plan: fortune.effective_plan,
                        daily_limit: fortune.daily_limit,
                        usage_today: fortune.usage_today
                    },
                    horoscope: {
                        effective_plan: horoscope.effective_plan,
                        daily_limit: horoscope.daily_limit,
                        usage_today: horoscope.usage_today
                    }
                };
                
                const resultDiv = document.getElementById(`${tier}-result`);
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<pre>${JSON.stringify(result, null, 2)}</pre>`;
            } catch (error) {
                const resultDiv = document.getElementById(`${tier}-result`);
                resultDiv.style.display = 'block';
                resultDiv.innerHTML = `<div style="color: #ef4444;">Error: ${error.message}</div>`;
            }
        }
    </script>
</body>
</html>